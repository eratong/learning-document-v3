import{_ as s,o as n,c as a,X as l}from"./chunks/framework.9bc23fa4.js";const p="/learning-document-v3/assets/image-20221221095452621.e9fbf220.png",o="/learning-document-v3/assets/image-20221221095618341.7eb5e8a2.png",e="/learning-document-v3/assets/image-20221221095956399.b1435bdd.png",t="/learning-document-v3/assets/image-20230713094459868.604b8407.png",C="/learning-document-v3/assets/image-20230713094513305.2b356ce1.png",c="/learning-document-v3/assets/image-20230713094851705.8133225a.png",r="/learning-document-v3/assets/image-20230713094914728.3e42c92a.png",y="/learning-document-v3/assets/image-20230713095000153.983acb7e.png",A="/learning-document-v3/assets/image-20230713095040891.c17fd0d7.png",D="/learning-document-v3/assets/image-20230713095442614.b46bbde1.png",i="/learning-document-v3/assets/image-20230713095512464.f9328aee.png",F="/learning-document-v3/assets/image-20230713095520229.44d359bc.png",d="/learning-document-v3/assets/image-20230713095528158.2bbd1f70.png",u="/learning-document-v3/assets/image-20230713095600977.3b1019f1.png",h="/learning-document-v3/assets/image-20230713095611422.b26e87c2.png",g="/learning-document-v3/assets/image1.860c2de4.png",m="/learning-document-v3/assets/image2.42ab64e4.png",N=JSON.parse('{"title":"redis","description":"","frontmatter":{},"headers":[],"relativePath":"data/后端/数据库/redis.md","filePath":"data/后端/数据库/redis.md","lastUpdated":1720420715000}'),b={name:"data/后端/数据库/redis.md"},E=l(`<h1 id="redis" tabindex="-1">redis <a class="header-anchor" href="#redis" aria-label="Permalink to &quot;redis&quot;">​</a></h1><h2 id="一、基础" tabindex="-1">一、基础 <a class="header-anchor" href="#一、基础" aria-label="Permalink to &quot;一、基础&quot;">​</a></h2><p>c语言编写的</p><h3 id="_1、特点" tabindex="-1">1、特点 <a class="header-anchor" href="#_1、特点" aria-label="Permalink to &quot;1、特点&quot;">​</a></h3><p>快的原因<br> 绝大部分请求是纯粹的内存操作（非常快速）, cpu不是redis性能瓶颈，redis的瓶颈是根据机器的内存和网络带宽<br> ​采用单线程，避免了不必要频繁的上下文切换和竞争条件<br> ​非阻塞I/O多路复用机制</p><h3 id="_2、持久化" tabindex="-1">2、持久化 <a class="header-anchor" href="#_2、持久化" aria-label="Permalink to &quot;2、持久化&quot;">​</a></h3><p>rdb<br> aof</p><h3 id="_3、部署模式" tabindex="-1">3、部署模式 <a class="header-anchor" href="#_3、部署模式" aria-label="Permalink to &quot;3、部署模式&quot;">​</a></h3><p>单机模式<br> 主从模式<br> 哨兵模式<br> 集群模式</p><h3 id="_4、数据类型" tabindex="-1">4、数据类型 <a class="header-anchor" href="#_4、数据类型" aria-label="Permalink to &quot;4、数据类型&quot;">​</a></h3><h4 id="常用命令" tabindex="-1">常用命令 <a class="header-anchor" href="#常用命令" aria-label="Permalink to &quot;常用命令&quot;">​</a></h4><h5 id="切换db" tabindex="-1">切换db <a class="header-anchor" href="#切换db" aria-label="Permalink to &quot;切换db&quot;">​</a></h5><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> fm_mg_store:business:store:calendar_201002 </span><span style="color:#F78C6C;">0</span></span></code></pre></div><h4 id="一、string-字符串" tabindex="-1">一、string(字符串) <a class="header-anchor" href="#一、string-字符串" aria-label="Permalink to &quot;一、string(字符串)&quot;">​</a></h4><p>底层数据结构：动态字符串（sds）</p><p>常用命令：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">get</span></span>
<span class="line"><span style="color:#F78C6C;">set</span></span>
<span class="line"><span style="color:#A6ACCD;">incr</span></span>
<span class="line"><span style="color:#A6ACCD;">decr</span></span>
<span class="line"><span style="color:#A6ACCD;">...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">SET</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;">                   设置key</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">value</span></span>
<span class="line"><span style="color:#F78C6C;">GET</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;">                         或者键key对应的值</span></span>
<span class="line"><span style="color:#A6ACCD;">GETRANGE </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">end</span><span style="color:#A6ACCD;">          得到字符串的子字符串存放在一个键</span></span>
<span class="line"><span style="color:#A6ACCD;">GETSET </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;">                设置键的字符串值，并返回旧值</span></span>
<span class="line"><span style="color:#A6ACCD;">GETBIT </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> offset               返回存储在键位值的字符串值的偏移</span></span>
<span class="line"><span style="color:#A6ACCD;">MGET key1 [key2..]              得到所有的给定键的值</span></span>
<span class="line"><span style="color:#A6ACCD;">SETBIT </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> offset </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;">         设置或清除该位在存储在键的字符串值偏移</span></span>
<span class="line"><span style="color:#A6ACCD;">SETEX </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> seconds </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;">         键到期时设置值</span></span>
<span class="line"><span style="color:#A6ACCD;">SETNX </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;">                 设置键的值，只有当该键不存在</span></span>
<span class="line"><span style="color:#A6ACCD;">SETRANGE </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> offset </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;">       覆盖字符串的一部分从指定键的偏移</span></span>
<span class="line"><span style="color:#A6ACCD;">STRLEN </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;">                      得到存储在键的值的长度</span></span>
<span class="line"><span style="color:#A6ACCD;">MSET </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> [key value...]   设置多个键和多个值</span></span>
<span class="line"><span style="color:#A6ACCD;">MSETNX </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> [key value...] 设置多个键多个值，只有在当没有按键的存在时</span></span>
<span class="line"><span style="color:#A6ACCD;">PSETEX </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> milliseconds </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;">   设置键的毫秒值和到期时间</span></span>
<span class="line"><span style="color:#A6ACCD;">INCR </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;">                        增加键的整数值一次</span></span>
<span class="line"><span style="color:#A6ACCD;">INCRBY </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> increment            由给定的数量递增键的整数值</span></span>
<span class="line"><span style="color:#A6ACCD;">INCRBYFLOAT </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> increment       由给定的数量递增键的浮点值</span></span>
<span class="line"><span style="color:#A6ACCD;">DECR </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;">                        递减键一次的整数值</span></span>
<span class="line"><span style="color:#A6ACCD;">DECRBY </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> decrement            由给定数目递减键的整数值</span></span>
<span class="line"><span style="color:#F78C6C;">APPEND</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;">                追加值到一个键</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">操作管理命令</span></span>
<span class="line"><span style="color:#A6ACCD;">DEL </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;">                         如果存在删除键</span></span>
<span class="line"><span style="color:#F78C6C;">DUMP</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;">                        返回存储在指定键的值的序列化版本</span></span>
<span class="line"><span style="color:#F78C6C;">EXISTS</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;">                      此命令检查该键是否存在</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPIRE </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> seconds              指定键的过期时间</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPIREAT </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">timestamp</span><span style="color:#A6ACCD;">          指定的键过期时间。在这里，时间是在Unix时间戳格式</span></span>
<span class="line"><span style="color:#A6ACCD;">PEXPIRE </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> milliseconds        设置键以毫秒为单位到期</span></span>
<span class="line"><span style="color:#A6ACCD;">PEXPIREAT </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> milliseconds</span><span style="color:#89DDFF;">-</span><span style="color:#C792EA;">timestamp</span><span style="color:#A6ACCD;">        设置键在Unix时间戳指定为毫秒到期</span></span>
<span class="line"><span style="color:#A6ACCD;">KEYS pattern                    查找与指定模式匹配的所有键</span></span>
<span class="line"><span style="color:#F78C6C;">MOVE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> db                     移动键到另一个数据库</span></span>
<span class="line"><span style="color:#A6ACCD;">PERSIST </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;">                     移除过期的键</span></span>
<span class="line"><span style="color:#A6ACCD;">PTTL </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;">                        以毫秒为单位获取剩余时间的到期键。</span></span>
<span class="line"><span style="color:#A6ACCD;">TTL </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;">                         获取键到期的剩余时间。</span></span>
<span class="line"><span style="color:#A6ACCD;">RANDOMKEY                       从Redis返回随机键</span></span>
<span class="line"><span style="color:#A6ACCD;">RENAME </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> newkey               更改键的名称</span></span>
<span class="line"><span style="color:#A6ACCD;">RENAMENX </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> newkey             重命名键，如果新的键不存在</span></span>
<span class="line"><span style="color:#F78C6C;">TYPE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;">                        返回存储在键的数据类型的值。</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">操作使用示例</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> baidu </span><span style="color:#F78C6C;">http</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;">www.baidu</span></span>
<span class="line"><span style="color:#A6ACCD;">OK</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">append</span><span style="color:#A6ACCD;"> baidu .com</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">20</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">get</span><span style="color:#A6ACCD;"> baidu</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://www.baidu.com</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> visitors </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">OK</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> incr visitors</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> incr visitors</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">get</span><span style="color:#A6ACCD;"> visitors</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> incrby visitors </span><span style="color:#F78C6C;">100</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">102</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">get</span><span style="color:#A6ACCD;"> visitors</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">102</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">type</span><span style="color:#A6ACCD;"> baidu</span></span>
<span class="line"><span style="color:#A6ACCD;">string</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">type</span><span style="color:#A6ACCD;"> visitors</span></span>
<span class="line"><span style="color:#A6ACCD;">string</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> ttl baidu</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> rename baidu baidu</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">site</span></span>
<span class="line"><span style="color:#A6ACCD;">OK</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">get</span><span style="color:#A6ACCD;"> baidu</span></span>
<span class="line"><span style="color:#A6ACCD;">(nil)</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">get</span><span style="color:#A6ACCD;"> baidu</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">site</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://www.baidu.com</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">.在创建一个key </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> 的时候同时设置过期时间</span></span>
<span class="line"><span style="color:#A6ACCD;">比如: </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> key1 value1 EX </span><span style="color:#F78C6C;">60</span><span style="color:#A6ACCD;"> 表示: 我们想要将这个 </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> 放到redis中,并在其中保存60秒.</span></span>
<span class="line"><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> key2 value2 PX </span><span style="color:#F78C6C;">60</span><span style="color:#A6ACCD;"> 表示:我们想要将这个key value放到redis中,并在其中保存 60毫秒</span></span>
<span class="line"><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">.对于已经存在的key </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;">, </span></span>
<span class="line"><span style="color:#A6ACCD;">比如: 事先有 </span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> key3 value3</span></span>
<span class="line"><span style="color:#A6ACCD;">我们想为 key3 设置一个过期时间, 我们可以采用以下命令:  </span></span>
<span class="line"><span style="color:#A6ACCD;">expire  key3 </span><span style="color:#F78C6C;">60</span><span style="color:#A6ACCD;">  表示: 我们要对已经存在的kye3 设置为 在 60秒之后(无效,或者被删除)</span></span>
<span class="line"><span style="color:#A6ACCD;">我们可以查看一个key当前的 存活(有效?)时间.</span></span>
<span class="line"><span style="color:#A6ACCD;">使用ttl key4 即可查看剩余有效时间.</span></span></code></pre></div><h4 id="二、hash-字典" tabindex="-1">二、hash(字典) <a class="header-anchor" href="#二、hash-字典" aria-label="Permalink to &quot;二、hash(字典)&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">类似C#中的dict类型或者C</span><span style="color:#89DDFF;">++</span><span style="color:#A6ACCD;">中的hash_map类型。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Redis Hash对应Value内部实际就是一个HashMap，实际这里会有2种不同实现，这个Hash的成员比较少时Redis为了节省内存会采用类似一维数组的方式来紧凑存储，而不会采用真正的HashMap结构，对应的value redisObject的encoding为zipmap,当成员数量增大时会自动转成真正的HashMap,此时encoding为ht。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">应用场景</span></span>
<span class="line"><span style="color:#A6ACCD;">假设有多个用户及对应的用户信息，可以用来存储以用户ID为key，将用户信息序列化为比如json格式做为value进行保存。</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">相关命令</span></span>
<span class="line"><span style="color:#A6ACCD;">HDEL</span></span>
<span class="line"><span style="color:#A6ACCD;">HDEL </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> field[field...] 删除对象的一个或几个属性域，不存在的属性将被忽略</span></span>
<span class="line"><span style="color:#A6ACCD;">HEXISTS</span></span>
<span class="line"><span style="color:#A6ACCD;">HEXISTS </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> field 查看对象是否存在该属性域</span></span>
<span class="line"><span style="color:#A6ACCD;">HGET</span></span>
<span class="line"><span style="color:#A6ACCD;">HGET </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> field 获取对象中该field属性域的值</span></span>
<span class="line"><span style="color:#A6ACCD;">HGETALL</span></span>
<span class="line"><span style="color:#A6ACCD;">HGETALL </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> 获取对象的所有属性域和值</span></span>
<span class="line"><span style="color:#A6ACCD;">HINCRBY</span></span>
<span class="line"><span style="color:#A6ACCD;">HINCRBY </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> field </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> 将该对象中指定域的值增加给定的value，原子自增操作，只能是integer的属性值可以使用</span></span>
<span class="line"><span style="color:#A6ACCD;">HINCRBYFLOAT</span></span>
<span class="line"><span style="color:#A6ACCD;">HINCRBYFLOAT </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> field increment 将该对象中指定域的值增加给定的浮点数</span></span>
<span class="line"><span style="color:#A6ACCD;">HKEYS</span></span>
<span class="line"><span style="color:#A6ACCD;">HKEYS </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> 获取对象的所有属性字段</span></span>
<span class="line"><span style="color:#A6ACCD;">HVALS</span></span>
<span class="line"><span style="color:#A6ACCD;">HVALS </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> 获取对象的所有属性值</span></span>
<span class="line"><span style="color:#A6ACCD;">HLEN</span></span>
<span class="line"><span style="color:#A6ACCD;">HLEN </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> 获取对象的所有属性字段的总数</span></span>
<span class="line"><span style="color:#A6ACCD;">HMGET</span></span>
<span class="line"><span style="color:#A6ACCD;">HMGET </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> field[field...] 获取对象的一个或多个指定字段的值</span></span>
<span class="line"><span style="color:#A6ACCD;">HSET</span></span>
<span class="line"><span style="color:#A6ACCD;">HSET </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> field </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> 设置对象指定字段的值</span></span>
<span class="line"><span style="color:#A6ACCD;">HMSET</span></span>
<span class="line"><span style="color:#A6ACCD;">HMSET </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> field </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> [field value ...] 同时设置对象中一个或多个字段的值</span></span>
<span class="line"><span style="color:#A6ACCD;">HSETNX</span></span>
<span class="line"><span style="color:#A6ACCD;">HSETNX </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> field </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> 只在对象不存在指定的字段时才设置字段的值</span></span>
<span class="line"><span style="color:#A6ACCD;">HSTRLEN</span></span>
<span class="line"><span style="color:#A6ACCD;">HSTRLEN </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> field 返回对象指定field的value的字符串长度，如果该对象或者field不存在，返回0.</span></span>
<span class="line"><span style="color:#A6ACCD;">HSCAN</span></span>
<span class="line"><span style="color:#A6ACCD;">HSCAN </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">cursor</span><span style="color:#A6ACCD;"> [MATCH pattern] [COUNT count] 类似SCAN命令</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">使用示例</span></span>
<span class="line"><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> hset person </span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;"> jack</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> hset person age </span><span style="color:#F78C6C;">20</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> hset person sex famale</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> hget person </span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">jack</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> hgetall person</span></span>
<span class="line"><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">jack</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">age</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">20</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">5</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sex</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">famale</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> hkeys person</span></span>
<span class="line"><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">age</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sex</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> hvals person</span></span>
<span class="line"><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">jack</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">20</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">famale</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><h4 id="三、list-列表" tabindex="-1">三、list(列表) <a class="header-anchor" href="#三、list-列表" aria-label="Permalink to &quot;三、list(列表)&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">Redis列表是简单的字符串列表，可以类比到C</span><span style="color:#89DDFF;">++</span><span style="color:#A6ACCD;">中的std::list，简单的说就是一个链表或者说是一个队列。可以从头部或尾部向Redis列表添加元素。列表的最大长度为2^</span><span style="color:#F78C6C;">32</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">，也即每个列表支持超过40亿个元素。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Redis list的实现为一个双向链表，即可以支持反向查找和遍历，更方便操作，不过带来了部分额外的内存开销，Redis内部的很多实现，包括发送缓冲队列等也都是用的这个数据结构。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">应用场景</span></span>
<span class="line"><span style="color:#A6ACCD;">Redis list的应用场景非常多，也是Redis最重要的数据结构之一，比如twitter的关注列表、粉丝列表等都可以用Redis的list结构来实现，再比如有的应用使用Redis的list类型实现一个简单的轻量级消息队列，生产者push，消费者pop</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">bpop。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">相关命令</span></span>
<span class="line"><span style="color:#A6ACCD;">BLPOP</span></span>
<span class="line"><span style="color:#A6ACCD;">BLPOP key1 [key2 ] </span><span style="color:#F78C6C;">timeout</span><span style="color:#A6ACCD;"> 取出并获取列表中的第一个元素，或阻塞，直到有可用</span></span>
<span class="line"><span style="color:#A6ACCD;">BRPOP</span></span>
<span class="line"><span style="color:#A6ACCD;">BRPOP key1 [key2 ] </span><span style="color:#F78C6C;">timeout</span><span style="color:#A6ACCD;"> 取出并获取列表中的最后一个元素，或阻塞，直到有可用</span></span>
<span class="line"><span style="color:#A6ACCD;">BRPOPLPUSH</span></span>
<span class="line"><span style="color:#A6ACCD;">BRPOPLPUSH source destination </span><span style="color:#F78C6C;">timeout</span><span style="color:#A6ACCD;"> 从列表中弹出一个值，它推到另一个列表并返回它;或阻塞，直到有可用</span></span>
<span class="line"><span style="color:#A6ACCD;">LINDEX</span></span>
<span class="line"><span style="color:#A6ACCD;">LINDEX </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;"> 从一个列表其索引获取对应的元素</span></span>
<span class="line"><span style="color:#A6ACCD;">LINSERT</span></span>
<span class="line"><span style="color:#A6ACCD;">LINSERT </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">BEFORE</span><span style="color:#A6ACCD;">|</span><span style="color:#F78C6C;">AFTER</span><span style="color:#A6ACCD;"> pivot </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> 在列表中的其他元素之后或之前插入一个元素</span></span>
<span class="line"><span style="color:#A6ACCD;">LLEN</span></span>
<span class="line"><span style="color:#A6ACCD;">LLEN </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> 获取列表的长度</span></span>
<span class="line"><span style="color:#A6ACCD;">LPOP</span></span>
<span class="line"><span style="color:#A6ACCD;">LPOP </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> 获取并取出列表中的第一个元素</span></span>
<span class="line"><span style="color:#A6ACCD;">LPUSH</span></span>
<span class="line"><span style="color:#A6ACCD;">LPUSH </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> value1 [value2] 在前面加上一个或多个值的列表</span></span>
<span class="line"><span style="color:#A6ACCD;">LPUSHX</span></span>
<span class="line"><span style="color:#A6ACCD;">LPUSHX </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> 在前面加上一个值列表，仅当列表中存在</span></span>
<span class="line"><span style="color:#A6ACCD;">LRANGE</span></span>
<span class="line"><span style="color:#A6ACCD;">LRANGE </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">stop</span><span style="color:#A6ACCD;"> 从一个列表获取各种元素</span></span>
<span class="line"><span style="color:#A6ACCD;">LREM</span></span>
<span class="line"><span style="color:#A6ACCD;">LREM </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> count </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> 从列表中删除元素</span></span>
<span class="line"><span style="color:#A6ACCD;">LSET</span></span>
<span class="line"><span style="color:#A6ACCD;">LSET </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">index</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> 在列表中的索引设置一个元素的值</span></span>
<span class="line"><span style="color:#A6ACCD;">LTRIM</span></span>
<span class="line"><span style="color:#A6ACCD;">LTRIM </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">stop</span><span style="color:#A6ACCD;"> 修剪列表到指定的范围内</span></span>
<span class="line"><span style="color:#A6ACCD;">RPOP</span></span>
<span class="line"><span style="color:#A6ACCD;">RPOP </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> 取出并获取列表中的最后一个元素</span></span>
<span class="line"><span style="color:#A6ACCD;">RPOPLPUSH</span></span>
<span class="line"><span style="color:#A6ACCD;">RPOPLPUSH source destination 删除最后一个元素的列表，将其附加到另一个列表并返回它</span></span>
<span class="line"><span style="color:#A6ACCD;">RPUSH</span></span>
<span class="line"><span style="color:#A6ACCD;">RPUSH </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> value1 [value2] 添加一个或多个值到列表</span></span>
<span class="line"><span style="color:#A6ACCD;">RPUSHX</span></span>
<span class="line"><span style="color:#A6ACCD;">RPUSHX </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> 添加一个值列表，仅当列表中存在</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">使用示例</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> lpush list1 redis</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> lpush list1 hello</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> rpush list1 world</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> llen list1</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> lrange list1 </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">redis</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">world</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> lpop list1</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hello</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> rpop list1</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">world</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> lrange list1 </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">redis</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><h4 id="四、set-集合" tabindex="-1">四、set(集合) <a class="header-anchor" href="#四、set-集合" aria-label="Permalink to &quot;四、set(集合)&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">可以理解为一堆值不重复的列表，类似数学领域中的集合概念，且Redis也提供了针对集合的求交集、并集、差集等操作。</span></span>
<span class="line"><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;"> 的内部实现是一个 value永远为null的HashMap，实际就是通过计算hash的方式来快速排重的，这也是set能提供判断一个成员是否在集合内的原因。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">应用场景</span></span>
<span class="line"><span style="color:#A6ACCD;">Redis set对外提供的功能与list类似是一个列表的功能，特殊之处在于set是可以自动排重的，当你需要存储一个列表数据，又不希望出现重复数据时，set是一个很好的选择，并且set提供了判断某个成员是否在一个set集合内的重要接口，这个也是list所不能提供的。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">又或者在微博应用中，每个用户关注的人存在一个集合中，就很容易实现求两个人的共同好友功能。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">相关命令</span></span>
<span class="line"><span style="color:#A6ACCD;">SADD</span></span>
<span class="line"><span style="color:#A6ACCD;">SADD </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> member [member ...] 添加一个或者多个元素到集合(</span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;">)里</span></span>
<span class="line"><span style="color:#A6ACCD;">SACRD</span></span>
<span class="line"><span style="color:#A6ACCD;">SCARD </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> 获取集合里面的元素数量</span></span>
<span class="line"><span style="color:#A6ACCD;">SDIFF</span></span>
<span class="line"><span style="color:#A6ACCD;">SDIFF </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> [key ...] 获得队列不存在的元素</span></span>
<span class="line"><span style="color:#A6ACCD;">SDIFFSTORE</span></span>
<span class="line"><span style="color:#A6ACCD;">SDIFFSTORE destination </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> [key ...] 获得队列不存在的元素，并存储在一个关键的结果集</span></span>
<span class="line"><span style="color:#A6ACCD;">SINTER</span></span>
<span class="line"><span style="color:#A6ACCD;">SINTER </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> [key ...] 获得两个集合的交集</span></span>
<span class="line"><span style="color:#A6ACCD;">SINTERSTORE</span></span>
<span class="line"><span style="color:#A6ACCD;">SINTERSTORE destination </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> [key ...] 获得两个集合的交集，并存储在一个集合中</span></span>
<span class="line"><span style="color:#A6ACCD;">SISMEMBER</span></span>
<span class="line"><span style="color:#A6ACCD;">SISMEMBER </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> member 确定一个给定的值是一个集合的成员</span></span>
<span class="line"><span style="color:#A6ACCD;">SMEMBERS</span></span>
<span class="line"><span style="color:#A6ACCD;">SMEMBERS </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> 获取集合里面的所有key</span></span>
<span class="line"><span style="color:#A6ACCD;">SMOVE</span></span>
<span class="line"><span style="color:#A6ACCD;">SMOVE source destination member 移动集合里面的一个key到另一个集合</span></span>
<span class="line"><span style="color:#A6ACCD;">SPOP</span></span>
<span class="line"><span style="color:#A6ACCD;">SPOP </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> [count] 获取并删除一个集合里面的元素</span></span>
<span class="line"><span style="color:#A6ACCD;">SRANDMEMBER</span></span>
<span class="line"><span style="color:#A6ACCD;">SRANDMEMBER </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> [count] 从集合里面随机获取一个元素</span></span>
<span class="line"><span style="color:#A6ACCD;">SREM</span></span>
<span class="line"><span style="color:#A6ACCD;">SREM </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> member [member ...] 从集合里删除一个或多个元素，不存在的元素会被忽略</span></span>
<span class="line"><span style="color:#A6ACCD;">SUNION</span></span>
<span class="line"><span style="color:#A6ACCD;">SUNION </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> [key ...] 添加多个set元素</span></span>
<span class="line"><span style="color:#A6ACCD;">SUNIONSTORE</span></span>
<span class="line"><span style="color:#A6ACCD;">SUNIONSTORE destination </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> [key ...] 合并set元素，并将结果存入新的set里面</span></span>
<span class="line"><span style="color:#A6ACCD;">SSCAN</span></span>
<span class="line"><span style="color:#A6ACCD;">SSCAN </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">cursor</span><span style="color:#A6ACCD;"> [MATCH pattern] [COUNT count] 迭代set里面的元素</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">使用示例</span></span>
<span class="line"><span style="color:#A6ACCD;">redis</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> SADD myset </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">redis</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> SADD myset </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">World</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">redis</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> SMEMBERS myset</span></span>
<span class="line"><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">World</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hello</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">redis</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> SADD myset </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">one</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">redis</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> SISMEMBER myset </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">one</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">redis</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> SISMEMBER myset </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">two</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">0</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">使用集合数据结构的典型用例是朋友名单的实现：</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> sadd friends:leto ghanima paul chani jessica</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">4</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> sadd friends:duncan paul jessica alia</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> sismember friends:leto jessica</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">   #不管一个用户有多少个朋友，我们都能高效地（O(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)时间复杂度）识别出用户X是不是用户Y的朋友</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> sismember friends:leto vladimir</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> sinter friends:leto friends:duncan    #我们可以查看两个或更多的人是不是有共同的朋友</span></span>
<span class="line"><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">paul</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">jessica</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> sinterstore friends:leto_duncan friends:leto friends:duncan # 可以在一个新的关键字里存储结果</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">2</span></span></code></pre></div><h4 id="五、sorted-set-zset-有序集合" tabindex="-1">五、sorted set / zset(有序集合) <a class="header-anchor" href="#五、sorted-set-zset-有序集合" aria-label="Permalink to &quot;五、sorted set / zset(有序集合)&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">Redis有序集合类似Redis集合，不同的是增加了一个功能，即集合是有序的。一个有序集合的每个成员带有分数，用于进行排序。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Redis有序集合添加、删除和测试的时间复杂度均为O(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)(固定时间，无论里面包含的元素集合的数量)。列表的最大长度为2^</span><span style="color:#F78C6C;">32</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;"> 1元素(</span><span style="color:#F78C6C;">4294967295</span><span style="color:#A6ACCD;">，超过40亿每个元素的集合)。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Redis sorted set的内部使用HashMap和跳跃表(SkipList)来保证数据的存储和有序，HashMap里放的是成员到score的映射，而跳跃表里存放的是所有的成员，排序依据是HashMap里存的score,使用跳跃表的结构可以获得比较高的查找效率，并且在实现上比较简单。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">使用场景</span></span>
<span class="line"><span style="color:#A6ACCD;">Redis sorted set的使用场景与set类似，区别是set不是自动有序的，而sorted set可以通过用户额外提供一个优先级(score)的参数来为成员排序，并且是插入有序的，即自动排序。当你需要一个有序的并且不重复的集合列表，那么可以选择sorted set数据结构，比如twitter 的public timeline可以以发表时间作为score来存储，这样获取时就是自动按时间排好序的。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">又比如用户的积分排行榜需求就可以通过有序集合实现。还有上面介绍的使用List实现轻量级的消息队列，其实也可以通过Sorted Set实现有优先级或按权重的队列。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">相关命令</span></span>
<span class="line"><span style="color:#A6ACCD;">ZADD</span></span>
<span class="line"><span style="color:#A6ACCD;">ZADD </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> score1 member1 [score2 member2] 添加一个或多个成员到有序集合，或者如果它已经存在更新其分数</span></span>
<span class="line"><span style="color:#A6ACCD;">ZCARD</span></span>
<span class="line"><span style="color:#A6ACCD;">ZCARD </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> 得到的有序集合成员的数量</span></span>
<span class="line"><span style="color:#A6ACCD;">ZCOUNT</span></span>
<span class="line"><span style="color:#A6ACCD;">ZCOUNT </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> min max 计算一个有序集合成员与给定值范围内的分数</span></span>
<span class="line"><span style="color:#A6ACCD;">ZINCRBY</span></span>
<span class="line"><span style="color:#A6ACCD;">ZINCRBY </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> increment member 在有序集合增加成员的分数</span></span>
<span class="line"><span style="color:#A6ACCD;">ZINTERSTORE</span></span>
<span class="line"><span style="color:#A6ACCD;">ZINTERSTORE destination numkeys </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> [key ...] 多重交叉排序集合，并存储生成一个新的键有序集合。</span></span>
<span class="line"><span style="color:#A6ACCD;">ZLEXCOUNT</span></span>
<span class="line"><span style="color:#A6ACCD;">ZLEXCOUNT </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> min max 计算一个给定的字典范围之间的有序集合成员的数量</span></span>
<span class="line"><span style="color:#A6ACCD;">ZRANGE</span></span>
<span class="line"><span style="color:#A6ACCD;">ZRANGE </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">stop</span><span style="color:#A6ACCD;"> [WITHSCORES] 由索引返回一个成员范围的有序集合（从低到高）</span></span>
<span class="line"><span style="color:#A6ACCD;">ZRANGEBYLEX</span></span>
<span class="line"><span style="color:#A6ACCD;">ZRANGEBYLEX </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> min max [LIMIT offset count]返回一个成员范围的有序集合（由字典范围）</span></span>
<span class="line"><span style="color:#A6ACCD;">ZRANGEBYSCORE</span></span>
<span class="line"><span style="color:#A6ACCD;">ZRANGEBYSCORE </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> min max [WITHSCORES] [LIMIT] 返回有序集key中，所有 score 值介于 min 和 max 之间(包括等于 min 或 max )的成员，有序集成员按 score 值递增(从小到大)次序排列</span></span>
<span class="line"><span style="color:#A6ACCD;">ZRANK</span></span>
<span class="line"><span style="color:#A6ACCD;">ZRANK </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> member 确定成员的索引中有序集合</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREM</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREM </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> member [member ...] 从有序集合中删除一个或多个成员，不存在的成员将被忽略</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREMRANGEBYLEX</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREMRANGEBYLEX </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> min max 删除所有成员在给定的字典范围之间的有序集合</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREMRANGEBYRANK</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREMRANGEBYRANK </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">stop</span><span style="color:#A6ACCD;"> 在给定的索引之内删除所有成员的有序集合</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREMRANGEBYSCORE</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREMRANGEBYSCORE </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> min max 在给定的分数之内删除所有成员的有序集合</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREVRANGE</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREVRANGE </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">start</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">stop</span><span style="color:#A6ACCD;"> [WITHSCORES] 返回一个成员范围的有序集合，通过索引，以分数排序，从高分到低分</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREVRANGEBYSCORE</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREVRANGEBYSCORE </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> max min [WITHSCORES] 返回一个成员范围的有序集合，以socre排序从高到低</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREVRANK</span></span>
<span class="line"><span style="color:#A6ACCD;">ZREVRANK </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> member 确定一个有序集合成员的索引，以分数排序，从高分到低分</span></span>
<span class="line"><span style="color:#A6ACCD;">ZSCORE</span></span>
<span class="line"><span style="color:#A6ACCD;">ZSCORE </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> member 获取给定成员相关联的分数在一个有序集合</span></span>
<span class="line"><span style="color:#A6ACCD;">ZUNIONSTORE</span></span>
<span class="line"><span style="color:#A6ACCD;">ZUNIONSTORE destination numkeys </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> [key ...] 添加多个集排序，所得排序集合存储在一个新的键</span></span>
<span class="line"><span style="color:#A6ACCD;">ZSCAN</span></span>
<span class="line"><span style="color:#A6ACCD;">ZSCAN </span><span style="color:#F78C6C;">key</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">cursor</span><span style="color:#A6ACCD;"> [MATCH pattern] [COUNT count] 增量迭代排序元素集和相关的分数</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">使用示例</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> zadd dbs </span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;"> redis</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> zadd dbs </span><span style="color:#F78C6C;">98</span><span style="color:#A6ACCD;"> memcached</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> zadd dbs </span><span style="color:#F78C6C;">99</span><span style="color:#A6ACCD;"> mongodb</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> zadd dbs </span><span style="color:#F78C6C;">99</span><span style="color:#A6ACCD;"> leveldb</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> zcard dbs</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">4</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> zcount dbs </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">99</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">3</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> zrank dbs leveldb</span></span>
<span class="line"><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> zrank dbs other</span></span>
<span class="line"><span style="color:#A6ACCD;">(nil)</span></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> zrangebyscore dbs </span><span style="color:#F78C6C;">98</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span></span>
<span class="line"><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">memcached</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">leveldb</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mongodb</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">redis</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><h2 id="redis-发布订阅模型" tabindex="-1">Redis 发布订阅模型 <a class="header-anchor" href="#redis-发布订阅模型" aria-label="Permalink to &quot;Redis 发布订阅模型&quot;">​</a></h2><p>Redis订阅端:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> SUBSCRIBE redisChat</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Reading messages... (press Ctrl</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">C </span><span style="color:#F78C6C;">to</span><span style="color:#A6ACCD;"> quit)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">subscribe</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">redisChat</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">)(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span></code></pre></div><p>现在，两个客户端都发布在同一个通道名redisChat消息及以上的订阅客户端接收消息。</p><p>Redis 发布端</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> PUBLISH redisChat </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Redis is  a great caching technique</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">integer</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">redis </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">6379</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> PUBLISH redisChat </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Learn redis by tutorials point</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><p>发布后的消息会被多个订阅端同时接收到</p><p>原理：</p><p>RedisServer包含两个重要的结构：</p><p>1.channels：实际上就是一个key-value的Map结构,key为订阅地频道，value为Client的List</p><p>2.patterns:存放模式+client地址的列表</p><p>从pubsub_channels中找出跟publish中channel相符的clients-list，然后再去pubsub_patterns中找出每一个相符的pattern和client。向这些客户端发送publish的消息。</p><p>在程序终止或者类的实例被销毁的时候，请将订阅者实例注销掉，否则，在redis中一直存在这个订阅者。</p><h2 id="二、常见问题" tabindex="-1">二、常见问题 <a class="header-anchor" href="#二、常见问题" aria-label="Permalink to &quot;二、常见问题&quot;">​</a></h2><h3 id="_1、击穿" tabindex="-1">1、击穿 <a class="header-anchor" href="#_1、击穿" aria-label="Permalink to &quot;1、击穿&quot;">​</a></h3><p><img src="`+p+`" alt="image-20221221095452621"></p><h4 id="解决方案" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案" aria-label="Permalink to &quot;解决方案&quot;">​</a></h4><p>Redis 添加布隆过滤器,请求过来就可以经过布隆过滤器过滤一下</p><h4 id="java解决方案" tabindex="-1">java解决方案 <a class="header-anchor" href="#java解决方案" aria-label="Permalink to &quot;java解决方案&quot;">​</a></h4><h5 id="redis分布式锁" tabindex="-1">redis分布式锁 <a class="header-anchor" href="#redis分布式锁" aria-label="Permalink to &quot;redis分布式锁&quot;">​</a></h5><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 防止重复点击</span></span>
<span class="line"><span style="color:#C792EA;">Boolean</span><span style="color:#A6ACCD;"> lock </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> redisCache</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">opsForValue</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">setIfAbsent</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">lockKey</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">uuid</span><span style="color:#89DDFF;">,</span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">TimeUnit</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">SECONDS</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">Objects</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">equals</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">lock</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">Boolean</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">FALSE</span><span style="color:#89DDFF;">)){</span></span>
<span class="line"><span style="color:#A6ACCD;">	log</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">info</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">获取活动锁失败</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> response</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">...</span></span></code></pre></div><h5 id="reentrantlock" tabindex="-1">ReentrantLock <a class="header-anchor" href="#reentrantlock" aria-label="Permalink to &quot;ReentrantLock&quot;">​</a></h5><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">static</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">Lock</span><span style="color:#A6ACCD;"> reenLock </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">ReentrantLock</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#C792EA;">public</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">List</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getData04</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> throws InterruptedException </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#C792EA;">List</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">ArrayList</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">&gt;();</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;font-style:italic;">// 从缓存读取数据</span></span>
<span class="line"><span style="color:#A6ACCD;">        result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getDataFromCache</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isEmpty</span><span style="color:#89DDFF;">())</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">reenLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">tryLock</span><span style="color:#89DDFF;">())</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">try</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">我拿到锁了,从DB获取数据库后写入缓存</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;">                    </span><span style="color:#676E95;font-style:italic;">// 从数据库查询数据</span></span>
<span class="line"><span style="color:#A6ACCD;">                    result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getDataFromDB</span><span style="color:#89DDFF;">();</span></span>
<span class="line"><span style="color:#89DDFF;">                    </span><span style="color:#676E95;font-style:italic;">// 将查询到的数据写入缓存</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#82AAFF;">setDataToCache</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">finally</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    reenLock</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">unlock</span><span style="color:#89DDFF;">();</span><span style="color:#676E95;font-style:italic;">// 释放锁</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getDataFromCache</span><span style="color:#89DDFF;">();</span><span style="color:#676E95;font-style:italic;">// 先查一下缓存</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">result</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isEmpty</span><span style="color:#89DDFF;">())</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">                    System</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">out</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">println</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">我没拿到锁,缓存也没数据,先小憩一下</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">                    Thread</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">sleep</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">);</span><span style="color:#676E95;font-style:italic;">// 小憩一会儿</span></span>
<span class="line"><span style="color:#A6ACCD;">                    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getData04</span><span style="color:#89DDFF;">();</span><span style="color:#676E95;font-style:italic;">// 重试</span></span>
<span class="line"><span style="color:#A6ACCD;">                </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_2、穿透" tabindex="-1">2、穿透 <a class="header-anchor" href="#_2、穿透" aria-label="Permalink to &quot;2、穿透&quot;">​</a></h3><p><img src="`+o+`" alt="image-20221221095618341"></p><h4 id="解决方案-1" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案-1" aria-label="Permalink to &quot;解决方案&quot;">​</a></h4><p>对用户做缓存，限制每个用户短时间只能访问一次 查询出来没有的也缓存下，不要一直去查数据库</p><h4 id="java解决方案-1" tabindex="-1">java解决方案 <a class="header-anchor" href="#java解决方案-1" aria-label="Permalink to &quot;java解决方案&quot;">​</a></h4><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">redis查出来空值</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> 没数据</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">数据库查询出来是空的</span><span style="color:#89DDFF;">){</span></span>
<span class="line"><span style="color:#A6ACCD;">	缓存空值几分钟</span></span>
<span class="line"><span style="color:#A6ACCD;">	</span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> 没数据</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="_3、雪崩" tabindex="-1">3、雪崩 <a class="header-anchor" href="#_3、雪崩" aria-label="Permalink to &quot;3、雪崩&quot;">​</a></h3><p><img src="`+e+`" alt="image-20221221095956399"></p><h4 id="解决方案-2" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案-2" aria-label="Permalink to &quot;解决方案&quot;">​</a></h4><p>各个key过期时间尽量错开</p><h3 id="_4、排查大key" tabindex="-1">4、排查大key <a class="header-anchor" href="#_4、排查大key" aria-label="Permalink to &quot;4、排查大key&quot;">​</a></h3><p>合理的 Key 中 Value 的字节大小，推荐<strong>小于 10 KB</strong>。</p><p>过大的 Value 会引发数据倾斜、热点Key、实例流量或 CPU 性能被占满等问题，应从设计源头上避免此类问题带来的性能影响。</p><h4 id="_1-string查大key命令" tabindex="-1">① string查大Key命令 <a class="header-anchor" href="#_1-string查大key命令" aria-label="Permalink to &quot;① string查大Key命令&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">redis</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">cli </span><span style="color:#676E95;font-style:italic;">--bigkeys</span></span>
<span class="line"><span style="color:#A6ACCD;">redis</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">cli </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">h </span><span style="color:#F78C6C;">127</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">p </span><span style="color:#F78C6C;">6379</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">a </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">password</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">--bigkeys</span></span></code></pre></div><p>原因：string 类型统计的是 value 的字节数；另外 4 种复杂结构的类型统计的是元素个数，不能直观的看出 value 占用字节数，所以 --bigkeys 对分析 string 类型的大 key 是有用的，而复杂结构的类型还需要一些第三方工具。</p><h4 id="_2-redis4-0后新特性" tabindex="-1">② redis4.0后新特性 <a class="header-anchor" href="#_2-redis4-0后新特性" aria-label="Permalink to &quot;② redis4.0后新特性&quot;">​</a></h4><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">查看key大小</span></span>
<span class="line"><span style="color:#A6ACCD;">MEMORY USAGE keyname1</span></span></code></pre></div><h4 id="_3-使用-rdbtools-工具包" tabindex="-1">③ 使用 Rdbtools 工具包 <a class="header-anchor" href="#_3-使用-rdbtools-工具包" aria-label="Permalink to &quot;③ 使用 Rdbtools 工具包&quot;">​</a></h4><p>Rdbtools 是 python写的 一个第三方开源工具，用来解析 Redis 快照文件。除了解析 rdb 文件，还提供了统计单个 key 大小的工具。</p><p>1、安装</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">git clone https://github.com/sripathikrishnan/redis-rdb-tools</span></span>
<span class="line"><span style="color:#A6ACCD;">cd redis-rdb-tools sudo &amp;&amp; python setup.py install</span></span></code></pre></div><p>2、使用</p><p>从 <code>dump.rdb</code> 快照文件统计, 将所有 &gt; 10kb 的 key 输出到一个 csv 文件</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">rdb dump.rdb -c memory --bytes 10240 -f live_redis.csv</span></span></code></pre></div><h4 id="解决方案-3" tabindex="-1">解决方案 <a class="header-anchor" href="#解决方案-3" aria-label="Permalink to &quot;解决方案&quot;">​</a></h4><ol><li>拆分成多个小字符串</li></ol><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># 原始大字符串</span></span>
<span class="line"><span style="color:#A6ACCD;">SET user:1:description &quot;Very long description...&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"># 分割后的小字符串片段</span></span>
<span class="line"><span style="color:#A6ACCD;">SET user:1:description:part1 &quot;Very long&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">SET user:1:description:part2 &quot; description...&quot;</span></span></code></pre></div><ol start="2"><li>使用压缩算法<br> 对于文本型的数据，可以考虑使用Redis支持的压缩功能，如zstd压缩算法，以减小存储空间。</li></ol><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">SET user:1:description &quot;Compressed description...&quot; ZSTD</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">注意：需要在客户端应用中进行解压缩，因为Redis本身并不会自动解压缩存储的值。</span></span></code></pre></div><ol start="3"><li>使用其他数据结构<br> 如果字符串的值具有结构化信息，可以考虑使用其他数据结构，如Hash或List。这样可以更好地组织数据并避免一个键变得过大。</li></ol><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">HSET user:1:info description &quot;Very long description...&quot;</span></span></code></pre></div><h3 id="redis热key问题" tabindex="-1">redis热key问题 <a class="header-anchor" href="#redis热key问题" aria-label="Permalink to &quot;redis热key问题&quot;">​</a></h3><p>增加redis实例</p><p>采用二级缓存 将热点key缓存到jvm里面</p><p>参考文档<br><a href="https://juejin.cn/post/7338645701658574885" target="_blank" rel="noreferrer">https://juejin.cn/post/7338645701658574885</a></p><p>电子书推荐 <a href="https://zhuanlan.zhihu.com/p/361220843" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/361220843</a> 《Redis设计与实现》 《Redis实战》</p><h3 id="_5、告警" tabindex="-1">5、告警 <a class="header-anchor" href="#_5、告警" aria-label="Permalink to &quot;5、告警&quot;">​</a></h3><p>观察哪些</p><h3 id="_6、降级" tabindex="-1">6、降级 <a class="header-anchor" href="#_6、降级" aria-label="Permalink to &quot;6、降级&quot;">​</a></h3><p>Redis应用侧配置的坑-默认配置</p><p>超时时间目前版本spring中使用的redis客户端默认超时时间是1min，默认redirect次数是5一单redis发生超时中断，则有可能需要等待5*1min=5min时间默认降级不生效，因为上游早就判定超时了应用直接被拖死，因为单请求耗时过长导致线程池耗尽</p><p>可用性问题目前版本spring中使用的redis客户端默认的集群拓补自动刷新开关是关闭的redis集群中发生主从切换的话，应用依旧回去请求切换之前的节点如果有一个节点死了，应用由于不会自动刷新集群，所以会有1/n（集群node数量）概率失败</p><p>超大Key我们在redis使用过程中或多或少会用到一些Hash，List之类的数据类型，但是如果使用不当可能会造成一些问题redis中的数据结构都是k，v形式的，List，Hash等类型只是v的类型，集群的分片也是基于k来的，所以一个List，一个Hash里面的所有元素都会在一个节点上，可能导致某个节点内存过大，所以设计的时候需要考虑下分散各个节点压力如果集合里面的数据量过大的话，批量获取的场景一定要分页，否则或出现程序上的OOM还有可能对redis的性能造成大的影响超大集合在删除的时候依然会出现性能问题。懒 Redis 是更好的 Redis - OSCHINA - 中文开源技术交流社区 4.0之后可以通过惰性删除来处理这类问题 switch from del() to unklink() for redis &gt;= 4.0 · Issue #158 · colinmollenhour/Cm_Cache_Backend_Redis (github.com)</p><p>使用命令不当会导致redis的cpu使用率飙升，产生慢查询keys命令scan分页每页量过大flushAll等批量操作使用RDM工具访问key很多的生产环境redisRDM打开redis会不断去scan key，10000个一页如果key非常多的话，则有可能产生慢查询从而告警</p><p>Redission使用过程中的一些问题 redission是一款非常优秀的rediscli，除了实现了基本的redis操作之外，还支持RedLock这种级别的分布式锁，甚至在NAT场景下Redission也能完美兼容cluster，sentinel这类高可用架构，但是有部分版本的Redission在使用过程中出现了连接溢出的情况，在3.16.4版本修复，也就是在网络不稳定的情况下每次发生集群拓补发生变更时，创建slave连接时候不会判断自己是否已经维护了slave的连接，总是重新创建，issue:<a href="https://github.com/redisson/redisson/issues/3871pr:" target="_blank" rel="noreferrer">https://github.com/redisson/redisson/issues/3871pr:</a> <a href="https://github.com/redisson/redisson/commit/6bb333299610ff1ef173cc18f584ab799e9eaa14" target="_blank" rel="noreferrer">https://github.com/redisson/redisson/commit/6bb333299610ff1ef173cc18f584ab799e9eaa14</a></p><p><img src="`+t+'" alt="image-20230713094459868"></p><p><img src="'+C+'" alt="image-20230713094513305"></p><p>容器化部署后的redis如果出现故障，会发生漂移而早期版本的jedis刷新集群拓补并不是用的初始Url，而是第一次获取的集群列表。这个就导致jedis无法获取到最新的集群列表，从而应用出现无法连接redis的故障，然后就出现了跌停</p><p>Redis高可用-sentinel</p><p><img src="'+c+'" alt="image-20230713094851705"></p><p>Redis高可用-cluster</p><p><img src="'+r+'" alt="image-20230713094914728"></p><p>超时时间</p><p><img src="'+y+'" alt="image-20230713095000153"></p><p>集群模式拓补结构自动刷新</p><p><img src="'+A+'" alt="image-20230713095040891"></p><p>作为缓存使用降级为内存存储优点： 1、性能提高缺点： 1、内存消耗增加，可能引起频繁GC，甚至crash。（需要利用好lru策略） 2、有一致性问题。如果数据发生更新会导致各节点数据不一致，解决成本较高，需要依赖mq或者一致性算法需要的操作： 1、内存缓存设置很低的超时时间，以缓解一致性问题 2、提前做好压测，发生问题时候监控内存消耗以及gc情况降级为数据库优点： 1、一致性问题可以得到保证缺点 1、主从延迟会导致一定时间获取不到最新数据 2、性能降低需要的操作： 1、做好无缓存压测得到tps阈值，发生问题的时候在kong网关配置限流保护db 2、redis恢复后需要删除redis数据，以防脏读</p><p>作为分布式锁使用降级为无锁优点： 1、复杂度最低缺点： 1、无法控制并发操作降级为数据库锁优点： 1、功能没有降级，依旧可以达到锁的能力缺点： 1、依赖db，对db连接池会造成一定的压力，可能会耗尽连接池，尽量乐观并发，悲观并发需要单独创建连接池需要的操作: 1、做好db锁的压测 2、不要依赖订单类负载较高的库</p><p>作为存储使用做好BCP预案，aliyun逃生使用db做降级存储</p><p>应用侧实践案例 - 超时应对</p><p>1.对获取redis连接进行拦截，在redis降级情况下直接返回异常，无需等待超时</p><p><img src="'+D+'" alt="image-20230713095442614"></p><p>1.对redis操作进行try catch2.当redis异常后从数据库获取数据3.使用redis降级开关对业务进行处理</p><p><img src="'+i+'" alt="image-20230713095512464"></p><p><img src="'+F+'" alt="image-20230713095520229"></p><p><img src="'+d+'" alt="image-20230713095528158"></p><p>应用侧实践案例 – 分布式锁</p><p>1.降级使用数据库锁替代</p><p><img src="'+u+'" alt="image-20230713095600977"></p><p><img src="'+h+`" alt="image-20230713095611422"></p><h3 id="_7、内存不足" tabindex="-1">7、内存不足 <a class="header-anchor" href="#_7、内存不足" aria-label="Permalink to &quot;7、内存不足&quot;">​</a></h3><p>在redis.conf文件<br> 一、设置最大运行内存<br> 注释&quot;maxmemory&quot; 参数表示不限制内存使用<br> 取消注释 &quot;maxmemory&quot; 参数，并将其值设置为期望的运行内存大小。值可以使用单位 K、M、G 来表示，如&quot;1G&quot;表示 1GB 内存。确保设置的内存大小合理，不要超过可用物理内存的限制。</p><p>二、配置内存淘汰策略<br> &quot;maxmemory-policy&quot;参数</p><p><strong>内存淘汰策略</strong><br> noeviction：不淘汰任何数据，当内存不足时，新增操作会报错，Redis 默认内存淘汰策略；<br> allkeys-lru：淘汰整个键值中最久未使用的键值；<br> allkeys-random：随机淘汰任意键值;<br> volatile-lru：淘汰所有设置了过期时间的键值中最久未使用的键值；<br> volatile-random：随机淘汰设置了过期时间的任意键值；<br> volatile-ttl：优先淘汰更早过期的键值。<br> 在 Redis 4.0 版本中又新增了 2 种淘汰机制：<br> volatile-lfu：淘汰所有设置了过期时间的键值中，最少使用的键值；<br> allkeys-lfu：淘汰整个键值中最少使用的键值。<br> 其中 allkeys-xxx 表示从所有的键值中淘汰数据，而 volatile-xxx 表示从设置了过期键的键值中淘汰数据。<br> 所以，现在 Redis 的版本中有 8 种内存淘汰策略。</p><h2 id="三、性能测试工具" tabindex="-1">三、性能测试工具 <a class="header-anchor" href="#三、性能测试工具" aria-label="Permalink to &quot;三、性能测试工具&quot;">​</a></h2><h3 id="redis-benchmark" tabindex="-1">redis-benchmark <a class="header-anchor" href="#redis-benchmark" aria-label="Permalink to &quot;redis-benchmark&quot;">​</a></h3><p><a href="https://redis.io/docs/management/optimization/benchmarks/" target="_blank" rel="noreferrer">https://redis.io/docs/management/optimization/benchmarks/</a></p><h2 id="四、底层原理" tabindex="-1">四、底层原理 <a class="header-anchor" href="#四、底层原理" aria-label="Permalink to &quot;四、底层原理&quot;">​</a></h2><p>C语言编写</p><h3 id="string" tabindex="-1">string <a class="header-anchor" href="#string" aria-label="Permalink to &quot;string&quot;">​</a></h3><p>动态字符串（SDString）数据结构是一个 C 语言结构体</p><p>紧凑存储：直接保存原始字节数据，无额外开销。<br> ​预分配机制：根据增长模式动态调整容量（如倍增策略），减少内存重新分配次数</p><div class="language-C"><button title="Copy Code" class="copy"></button><span class="lang">C</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">struct</span><span style="color:#A6ACCD;"> sdshdr </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> len</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">        // 字符串的长度，不包括结尾的空字符</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">int</span><span style="color:#F07178;"> free</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">       // 字符串分配的额外空间，用于扩展，避免频繁的内存分配</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">char</span><span style="color:#F07178;"> buf</span><span style="color:#C792EA;">[]</span><span style="color:#89DDFF;">;</span><span style="color:#676E95;font-style:italic;">     // 字符串的实际内容</span></span>
<span class="line"><span style="color:#89DDFF;">};</span></span></code></pre></div><p>当 len 达到当前内存的极限时，Redis 会进行内存重新分配，通常会增加字符串的容量，使得 free 字段有一定空间，以便下次操作时能够直接扩展。</p><p><img src="`+g+'" alt="image"> Redis 6.0版本和Redis5.0对比<br> Redis 6.0版本中，对于SDS的底层数据结构进行了升级。除了原有的SDS类之外，还有四个新的类：sdshdr8、sdshdr16、sdshdr32、sdshdr64。这些类的命名与其中的成员变量类型相关，分别表示使用8位、16位、32位、64位的无符号整数存储字符串长度和容量<br> 这样的设计可以根据实际情况选择更合适的底层数据结构，从而减少内存占用。例如，当存储的字符串长度较小时，可以选择使用sdshdr8或sdshdr16，而当存储的字符串长度较大时，则可以使用sdshdr32或sdshdr64</p><h3 id="hash" tabindex="-1">hash <a class="header-anchor" href="#hash" aria-label="Permalink to &quot;hash&quot;">​</a></h3><p>Redis 中的 Hash 类型通过哈希表（Hash Table）来实现，哈希表是一种基于键值对存储的映射结构。由 字典（dict） 结构和 键值对 组成的。</p><p>哈希的两种实现方式,具体使用哪种实现方式取决于哈希中元素的数量</p><ol><li>压缩列表（ziplist）<br> ziplist是一个经过特殊编码的双向链表，它不存储指向上一个链表节点和指向下一个链表节点的指针，而是存储上一个节点长度和当前节点长度，通过牺牲部分读写性能，来换取高效的内存空间利用率，是一种时间换空间的思想。只用在字段个数少，字段值小的场景里面。<br> 当 Redis 中的 Hash 类型包含的字段数目较少时，Redis 会使用 压缩列表（ziplist）来存储哈希。压缩列表是一种内存高效的连续块数据结构，专门用于存储小量的键值对。压缩列表是一个链表，每个元素包含了一个值。相对哈希表，它占用更少的内存。</li></ol><p>优点：内存占用小，适合小型的哈希（字段数目较少时）。<br> 缺点：查找、插入、删除的性能较差，因为需要遍历整个压缩列表。</p><p><img src="'+m+`" alt="image"></p><ol start="2"><li>哈希表（hashtable）<br> 当哈希的字段数量较多时，Redis 会使用 哈希表 来存储哈希数据。哈希表的底层实现和一般的哈希表相同，由多个桶（bucket）组成，每个桶可以存储多个键值对。</li></ol><p>优点：查找、插入和删除操作的时间复杂度为 O(1)，非常高效。<br> 缺点：内存消耗相对较大，尤其是哈希表中的桶数很多时</p><h3 id="list" tabindex="-1">list <a class="header-anchor" href="#list" aria-label="Permalink to &quot;list&quot;">​</a></h3><ol><li>压缩列表（ziplist） ：当列表元素较少且元素长度较短时采用，将元素紧凑存储在连续内存中，节省内存空间。</li><li>双向链表（linkedlist） ：当列表元素数量较多或元素长度较长时使用。双向链表的每个节点包含指向前一个节点和后一个节点的指针，便于在列表两端进行快速的插入和删除操作，时间复杂度为 (O(1))，但随机访问效率较低。</li><li>快速列表（quicklist） ：Redis 3.2 版本引入，结合了压缩列表和双向链表的优点。它将双向链表按段切分，每一段使用压缩列表存储数据，既保留了双向链表的快速插入和删除特性，又通过压缩列表节省了内存。</li></ol><h3 id="set" tabindex="-1">set <a class="header-anchor" href="#set" aria-label="Permalink to &quot;set&quot;">​</a></h3><ol><li>整数数组（intset） ：当集合中的所有元素都是整数值，且元素数量较少时使用。整数集合是一个有序的、无重复元素的整数数组，会根据元素大小自动调整存储类型，以节省内存。</li><li>哈希表（hashtable） ：当集合中的元素包含非整数值，或者元素数量较多时使用。哈希表通过哈希函数将元素映射到数组的某个位置，能快速判断元素是否存在于集合中，插入、删除和查找操作的平均时间复杂度为 (O(1))。</li></ol><h3 id="zset" tabindex="-1">zset <a class="header-anchor" href="#zset" aria-label="Permalink to &quot;zset&quot;">​</a></h3><ol><li>压缩列表（ziplist） ：当有序集合的元素数量较少，且元素的成员和分值都较短时使用。在压缩列表中，元素的成员和分值依次存储，且按分值从小到大排序。</li><li>跳跃表（skiplist）  和 哈希表（hashtable） ：当有序集合的元素数量较多，或者元素的成员和分值较长时，Redis 同时使用这两种结构。跳跃表是一种有序的数据结构，通过在每个节点中维护多个指向其他节点的指针，在查找元素时可跳过部分节点，提高查找效率；哈希表用于快速查找元素的分值，使获取元素分值的时间复杂度为 (O(1))。</li></ol><p>跳表原理</p><p>压缩策略</p><p>链表+索引</p><p>二分查找</p><p>O(logn)</p><p>redis为什么使用跳表作为索引，不使用B+树</p><p>因为B+树的原理是叶子节点存储数据，非叶子节点存储索引，B+树的每个节点可以存储多个关键字，它将节点大小设置为磁盘页的大小，充分利用了<strong>磁盘预读</strong>的功能。每次读取磁盘页时就会读取一整个节点，每个叶子节点还有指向前后节点的指针，<strong>为的是最大限度的降低磁盘的IO</strong>;</p><p>而<strong>Redis是内存中读取数据，不涉及IO</strong>，因为数据在内存中读取耗费的时间是从磁盘的IO读取的百万分之一，因此使用了跳表，利用<strong>空间换时间</strong>的方式，实现简单，且能提高查询效率。</p><p>redis为什么使用跳表作为索引，不使用红黑树</p><p>选择跳跃表而非红黑树作为有序集合实现方式的原因，并非是基于并发上的考虑，<strong>redis是单线程</strong>，仅仅是因为<strong>跳跃表的实现相较于红黑树更加简洁，内存占用更有优势</strong>。</p><p>按照区间查找数据这个操作，红黑树的效率没有跳表高</p><h2 id="五、java使用" tabindex="-1">五、java使用 <a class="header-anchor" href="#五、java使用" aria-label="Permalink to &quot;五、java使用&quot;">​</a></h2><h3 id="注意事项" tabindex="-1">注意事项 <a class="header-anchor" href="#注意事项" aria-label="Permalink to &quot;注意事项&quot;">​</a></h3><p>配置超时时间</p><h3 id="批量查询" tabindex="-1">批量查询 <a class="header-anchor" href="#批量查询" aria-label="Permalink to &quot;批量查询&quot;">​</a></h3><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">redisCache</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getRedisTemplate</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">opsForValue</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">multiSet</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">map</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">redisCache</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getRedisTemplate</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">opsForValue</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">multiGet</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">keys</span><span style="color:#89DDFF;">);</span></span></code></pre></div><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># multiSet 需要循环设置过期时间</span></span>
<span class="line"><span style="color:#A6ACCD;">redisCache</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getRedisTemplate</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">opsForValue</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">multiSet</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">map</span><span style="color:#89DDFF;">);</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#89DDFF;">(</span><span style="color:#C792EA;">Map</span><span style="color:#89DDFF;">.</span><span style="color:#C792EA;">Entry</span><span style="color:#89DDFF;">&lt;</span><span style="color:#C792EA;">String</span><span style="color:#89DDFF;">,</span><span style="color:#C792EA;">ProWorldCupHeaderDto</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> m </span><span style="color:#89DDFF;font-style:italic;">:</span><span style="color:#A6ACCD;"> map</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">entrySet</span><span style="color:#89DDFF;">()){</span></span>
<span class="line"><span style="color:#A6ACCD;">    redisCache</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getRedisTemplate</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">expire</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">m</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getKey</span><span style="color:#89DDFF;">(),</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1L</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;">redisCache</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getExpireConfig</span><span style="color:#89DDFF;">().</span><span style="color:#82AAFF;">getTimeUnit</span><span style="color:#89DDFF;">());</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>缓存 如何保证 Redis ⾼并发、⾼可⽤？</p><p>Redis 的主从复制原理能介绍⼀下么？</p><p>Redis 的哨兵原理能介绍⼀下么？ Redis 的持久化有哪⼏种⽅式？</p><p>不同的持久化机制都有什么优缺点？</p><p>持久化机制具体底层是如何实现的？ Redis 集群模式的⼯作原理能说⼀下么？</p><p>在集群模式下，Redis 的 key 是如何寻址的？分布式寻址都有哪些算法？</p><p>了解⼀致性 hash 算法吗？</p><p>如何动态增加和删除⼀个节点？</p><p>如何保证缓存与数据库的双写⼀致性？</p><p>Redis 的并发竞争问题是什么？如何解决这个问题？了解 Redis 事务的 CAS ⽅案吗？</p><p>springboot发布订阅</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">@Service</span></span>
<span class="line"><span style="color:#A6ACCD;">public class RedisPublisher {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    @Autowired</span></span>
<span class="line"><span style="color:#A6ACCD;">    private RedisTemplate&lt;String, Object&gt; redisTemplate;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    public void publish(String channel, String message) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        redisTemplate.convertAndSend(channel, message);</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">@Component</span></span>
<span class="line"><span style="color:#A6ACCD;">public class RedisListener implements MessageListener {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    @Override</span></span>
<span class="line"><span style="color:#A6ACCD;">    public void onMessage(Message message, byte[] pattern) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        String messageBody = new String(message.getBody());</span></span>
<span class="line"><span style="color:#A6ACCD;">        System.out.println(&quot;Received message: &quot; + messageBody);</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">@Configuration</span></span>
<span class="line"><span style="color:#A6ACCD;">@EnableRedisRepositories</span></span>
<span class="line"><span style="color:#A6ACCD;">public class RedisConfig {</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">    @Bean</span></span>
<span class="line"><span style="color:#A6ACCD;">    public RedisMessageListenerContainer messageListenerContainer(RedisConnectionFactory redisConnectionFactory, RedisListener newsSubscriber) {</span></span>
<span class="line"><span style="color:#A6ACCD;">        RedisMessageListenerContainer container = new RedisMessageListenerContainer();</span></span>
<span class="line"><span style="color:#A6ACCD;">        container.setConnectionFactory(redisConnectionFactory);</span></span>
<span class="line"><span style="color:#A6ACCD;">        container.addMessageListener(newsSubscriber, new ChannelTopic(&quot;news&quot;));</span></span>
<span class="line"><span style="color:#A6ACCD;">        return container;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div>`,177),k=[E];function q(R,S,f,v,T,P){return n(),a("div",null,k)}const L=s(b,[["render",q]]);export{N as __pageData,L as default};
