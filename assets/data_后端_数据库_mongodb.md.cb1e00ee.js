import{_ as s,o as a,c as n,X as l}from"./chunks/framework.9bc23fa4.js";const o="/learning-document-v3/assets/image1.cfc73819.png",p="/learning-document-v3/assets/image2.ffc55fdd.png",e="/learning-document-v3/assets/image3.38deab2c.png",t="/learning-document-v3/assets/image4.565561c7.png",c="/learning-document-v3/assets/image5.512c540d.png",r="/learning-document-v3/assets/image6.fef5fc6b.png",C="/learning-document-v3/assets/image7.0eaed08f.png",g=JSON.parse('{"title":"mongodb","description":"","frontmatter":{},"headers":[],"relativePath":"data/后端/数据库/mongodb.md","filePath":"data/后端/数据库/mongodb.md","lastUpdated":1720420715000}'),D={name:"data/后端/数据库/mongodb.md"},y=l(`<h1 id="mongodb" tabindex="-1">mongodb <a class="header-anchor" href="#mongodb" aria-label="Permalink to &quot;mongodb&quot;">​</a></h1><h2 id="基础" tabindex="-1">基础 <a class="header-anchor" href="#基础" aria-label="Permalink to &quot;基础&quot;">​</a></h2><p>MongoDB是一个NoSQL的非关系型数据库 ，支持海量数据存储，高性能的读写。</p><h3 id="源码-c" tabindex="-1">源码(c++) <a class="header-anchor" href="#源码-c" aria-label="Permalink to &quot;源码(c++)&quot;">​</a></h3><h3 id="默认端口27017" tabindex="-1">默认端口27017 <a class="header-anchor" href="#默认端口27017" aria-label="Permalink to &quot;默认端口27017&quot;">​</a></h3><h3 id="使用场景" tabindex="-1">使用场景 <a class="header-anchor" href="#使用场景" aria-label="Permalink to &quot;使用场景&quot;">​</a></h3><h3 id="数据类型" tabindex="-1">数据类型 <a class="header-anchor" href="#数据类型" aria-label="Permalink to &quot;数据类型&quot;">​</a></h3><h3 id="对比数据库" tabindex="-1">对比数据库 <a class="header-anchor" href="#对比数据库" aria-label="Permalink to &quot;对比数据库&quot;">​</a></h3><table><thead><tr><th>SQL术语/概念</th><th>MongoDB术语/概念</th><th>解释/说明</th></tr></thead><tbody><tr><td>database</td><td>database</td><td>数据库</td></tr><tr><td>table</td><td>collection</td><td>数据库表/集合</td></tr><tr><td>row</td><td>document</td><td>数据记录行/文档</td></tr><tr><td>column</td><td>field</td><td>数据字段/域</td></tr><tr><td>index</td><td>index</td><td>索引</td></tr><tr><td>table joins</td><td></td><td>表连接,MongoDB不支持</td></tr><tr><td>primary key</td><td>primary key</td><td>主键,MongoDB自动将_id字段设置为主键</td></tr></tbody></table><h2 id="常用语句" tabindex="-1">常用语句 <a class="header-anchor" href="#常用语句" aria-label="Permalink to &quot;常用语句&quot;">​</a></h2><h3 id="mongodb操作" tabindex="-1">mongodb操作 <a class="header-anchor" href="#mongodb操作" aria-label="Permalink to &quot;mongodb操作&quot;">​</a></h3><h3 id="数据库操作" tabindex="-1">数据库操作 <a class="header-anchor" href="#数据库操作" aria-label="Permalink to &quot;数据库操作&quot;">​</a></h3><h4 id="_1、切换、建库语句" tabindex="-1">1、切换、建库语句 <a class="header-anchor" href="#_1、切换、建库语句" aria-label="Permalink to &quot;1、切换、建库语句&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">use</span><span style="color:#A6ACCD;"> 【数据库名称】</span></span></code></pre></div><h4 id="_2、查看当前正在使用的数据库" tabindex="-1">2、查看当前正在使用的数据库 <a class="header-anchor" href="#_2、查看当前正在使用的数据库" aria-label="Permalink to &quot;2、查看当前正在使用的数据库&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">db;</span></span></code></pre></div><h4 id="_3、查询数据库" tabindex="-1">3、查询数据库 <a class="header-anchor" href="#_3、查询数据库" aria-label="Permalink to &quot;3、查询数据库&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">show dbs;</span></span>
<span class="line"><span style="color:#A6ACCD;">show databases;</span></span></code></pre></div><h4 id="_4、查看语句执行计划-explain" tabindex="-1">4、查看语句执行计划 explain <a class="header-anchor" href="#_4、查看语句执行计划-explain" aria-label="Permalink to &quot;4、查看语句执行计划 explain&quot;">​</a></h4><h3 id="集合操作-表操作" tabindex="-1">集合操作（表操作） <a class="header-anchor" href="#集合操作-表操作" aria-label="Permalink to &quot;集合操作（表操作）&quot;">​</a></h3><h4 id="_1、创建集合" tabindex="-1">1、创建集合 <a class="header-anchor" href="#_1、创建集合" aria-label="Permalink to &quot;1、创建集合&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">db.createCollection(</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h4 id="_2、查询集合" tabindex="-1">2、查询集合 <a class="header-anchor" href="#_2、查询集合" aria-label="Permalink to &quot;2、查询集合&quot;">​</a></h4><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">show collections;</span></span>
<span class="line"><span style="color:#A6ACCD;">show tables;</span></span></code></pre></div><h4 id="_3、删除集合" tabindex="-1">3、删除集合 <a class="header-anchor" href="#_3、删除集合" aria-label="Permalink to &quot;3、删除集合&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">db.集合名称.</span><span style="color:#F78C6C;">drop</span><span style="color:#89DDFF;">()</span></span></code></pre></div><h4 id="_4、集合规范" tabindex="-1">4、集合规范 <a class="header-anchor" href="#_4、集合规范" aria-label="Permalink to &quot;4、集合规范&quot;">​</a></h4><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">集合名不能是空字符串&quot;&quot;。</span></span>
<span class="line"><span style="color:#A6ACCD;">集合名不能含有\\0字符（空字符)，这个字符表示集合名的结尾。</span></span>
<span class="line"><span style="color:#A6ACCD;">集合名不能以&quot;system.&quot;开头，这是为系统集合保留的前缀。</span></span>
<span class="line"><span style="color:#A6ACCD;">用户创建的集合名字不能含有保留字符。有些驱动程序的确支持在集合名里面包含，这是因为某些系统生成的集合中包含该字符。除 非你要访问这种系统创建的集合，否则千万不要在名字里出现$。</span></span></code></pre></div><h3 id="文档操作-行操作" tabindex="-1">文档操作（行操作） <a class="header-anchor" href="#文档操作-行操作" aria-label="Permalink to &quot;文档操作（行操作）&quot;">​</a></h3><h4 id="_1、创建文档" tabindex="-1">1、创建文档 <a class="header-anchor" href="#_1、创建文档" aria-label="Permalink to &quot;1、创建文档&quot;">​</a></h4><p>文档的数据结构和JSON基本一样,所有存储在集合中的数据都是 BSON 格式。</p><p>JSON是纯文字的，应用很广泛；</p><p>BSON长得很JSON，二进制JSON，目前只用于MongoDB；</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">db.comment.</span><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;">({bson数据})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.</span><span style="color:#F78C6C;">insert</span><span style="color:#A6ACCD;">({</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">articleid</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">100000</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">content</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">今天天气真好，阳光媚</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">userid</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1001</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nickname</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Rose</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">createdatetime</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: new </span><span style="color:#C792EA;">Date</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">likenum</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: NumberInt(</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">state</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">null</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span></code></pre></div><h4 id="_2、批量创建文档" tabindex="-1">2、批量创建文档 <a class="header-anchor" href="#_2、批量创建文档" aria-label="Permalink to &quot;2、批量创建文档&quot;">​</a></h4><p>插入时指定了 _id ，则主键就是该值。 如果某条数据插入失败，将会终止插入，但已经插入成功的数据不会回滚掉</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">db.comment.insertMany([</span></span>
<span class="line"><span style="color:#A6ACCD;">    {</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">articleid</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">100001</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">content</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">我夏天空腹喝凉开水，冬天喝温开水</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">userid</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1005</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nickname</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">伊人憔悴</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">createdatetime</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: new </span><span style="color:#C792EA;">Date</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2019-08-05T23:58:51.485Z</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">likenum</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: NumberInt(</span><span style="color:#F78C6C;">888</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">state</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    },</span></span>
<span class="line"><span style="color:#A6ACCD;">    {</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">articleid</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">100001</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">content</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">我一直喝凉开水，冬天夏天都喝。</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">userid</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1004</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nickname</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">杰克船长</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">createdatetime</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: new </span><span style="color:#C792EA;">Date</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2019-08-06T01:05:06.321Z</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">likenum</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: NumberInt(</span><span style="color:#F78C6C;">666</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">state</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    },</span></span>
<span class="line"><span style="color:#A6ACCD;">    {</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">4</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">articleid</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">100001</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">content</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">专家说不能空腹吃饭，影响健康。</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">userid</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1003</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nickname</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">凯撒</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">createdatetime</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: new </span><span style="color:#C792EA;">Date</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2019-08-06T08:18:35.288Z</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">likenum</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: NumberInt(</span><span style="color:#F78C6C;">2000</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">state</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    },</span></span>
<span class="line"><span style="color:#A6ACCD;">    {</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">5</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">articleid</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">100001</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">content</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">研究表明，刚烧开的水千万不能喝，因为烫嘴。</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">userid</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1003</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">nickname</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">凯撒</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">createdatetime</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: new </span><span style="color:#C792EA;">Date</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2019-08-06T11:01:02.521Z</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">likenum</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: NumberInt(</span><span style="color:#F78C6C;">3000</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">state</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">]);</span></span></code></pre></div><h4 id="_3、查询文档" tabindex="-1">3、查询文档 <a class="header-anchor" href="#_3、查询文档" aria-label="Permalink to &quot;3、查询文档&quot;">​</a></h4><h5 id="_1、条件查询" tabindex="-1">1、条件查询 <a class="header-anchor" href="#_1、条件查询" aria-label="Permalink to &quot;1、条件查询&quot;">​</a></h5><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">db.comment.find</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find({})</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find({userid:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1003</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.findOne({userid:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1003</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">投影查询 </span></span>
<span class="line"><span style="color:#A6ACCD;">不显示所有字段，只显示指定的字段 比如下面的只显示_id、userid、nickname</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find({userid:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1003</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">},{userid:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">,nickname:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">id也不显示像这样</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find({userid:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1003</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">},{userid:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">,nickname:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">,_id:</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">不带条件查询_id、userid、nickname</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find({},{userid:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">,nickname:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">})</span></span></code></pre></div><h5 id="_2、条件连接查询" tabindex="-1">2、条件连接查询 <a class="header-anchor" href="#_2、条件连接查询" aria-label="Permalink to &quot;2、条件连接查询&quot;">​</a></h5><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">AND</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find({$</span><span style="color:#F78C6C;">and</span><span style="color:#A6ACCD;">:[{likenum:{$gte:NumberInt(700)}},{likenum:{$lt:NumberInt(2000)}}]})</span></span>
<span class="line"><span style="color:#F78C6C;">OR</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find({$</span><span style="color:#F78C6C;">or</span><span style="color:#A6ACCD;">:[ {userid:&quot;1003&quot;} ,{likenum:{$lt:1000} }]})</span></span></code></pre></div><h5 id="_3、分页查询" tabindex="-1">3、分页查询 <a class="header-anchor" href="#_3、分页查询" aria-label="Permalink to &quot;3、分页查询&quot;">​</a></h5><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">查询记录数</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.</span><span style="color:#82AAFF;">count</span><span style="color:#A6ACCD;">({userid:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1003</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">分页查询</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">skip</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">).</span><span style="color:#F78C6C;">limit</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">skip</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">).</span><span style="color:#F78C6C;">limit</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h5 id="_4、排序查询" tabindex="-1">4、排序查询 <a class="header-anchor" href="#_4、排序查询" aria-label="Permalink to &quot;4、排序查询&quot;">​</a></h5><p>1 和 -1 来指定排序的方式，其中 1 为升序排列，而 -1 是用 于降序排列</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">db.comment.find</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">.sort({userid:</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">,likenum:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">})</span></span></code></pre></div><p>skip(), limilt(), sort()三个放在一起执行的时候，执行的顺序是先 sort(), 然后是 skip()，最后是显示的 limit()，和命令编写顺序无关。</p><h5 id="_5、模糊查询-正则" tabindex="-1">5、模糊查询（正则） <a class="header-anchor" href="#_5、模糊查询-正则" aria-label="Permalink to &quot;5、模糊查询（正则）&quot;">​</a></h5><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">查询内容包含“开水的”</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find({content:</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">开水</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">查询内容以“专家”开头的</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find({content:</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">^专家</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">})</span></span></code></pre></div><h5 id="_6、比较查询" tabindex="-1">6、比较查询 <a class="header-anchor" href="#_6、比较查询" aria-label="Permalink to &quot;6、比较查询&quot;">​</a></h5><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">db.集合名称.find({ </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">field</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> : { $gt: </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> }}) </span><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;"> 大于: field </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span></span>
<span class="line"><span style="color:#A6ACCD;">db.集合名称.find({ </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">field</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> : { $lt: </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> }}) </span><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;"> 小于: field </span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span></span>
<span class="line"><span style="color:#A6ACCD;">db.集合名称.find({ </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">field</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> : { $gte: </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> }}) </span><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;"> 大于等于: field </span><span style="color:#89DDFF;">&gt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span></span>
<span class="line"><span style="color:#A6ACCD;">db.集合名称.find({ </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">field</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> : { $lte: </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> }}) </span><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;"> 小于等于: field </span><span style="color:#89DDFF;">&lt;=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span></span>
<span class="line"><span style="color:#A6ACCD;">db.集合名称.find({ </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">field</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> : { $ne: </span><span style="color:#F78C6C;">value</span><span style="color:#A6ACCD;"> }}) </span><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;"> 不等于: field </span><span style="color:#89DDFF;">!=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">value</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find({likenum:{$gt:NumberInt(</span><span style="color:#F78C6C;">700</span><span style="color:#A6ACCD;">)}})</span></span></code></pre></div><h5 id="_7、包含查询" tabindex="-1">7、包含查询 <a class="header-anchor" href="#_7、包含查询" aria-label="Permalink to &quot;7、包含查询&quot;">​</a></h5><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">包含</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find({userid:{$</span><span style="color:#F78C6C;">in</span><span style="color:#A6ACCD;">:[&quot;1003&quot;,&quot;1004&quot;]}})</span></span>
<span class="line"><span style="color:#A6ACCD;">不包含</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.find({userid:{$nin:[&quot;1003&quot;,&quot;1004&quot;]}})</span></span></code></pre></div><h4 id="_4、修改文档" tabindex="-1">4、修改文档 <a class="header-anchor" href="#_4、修改文档" aria-label="Permalink to &quot;4、修改文档&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">覆盖修改</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.</span><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;">({_id:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">},{likenum:NumberInt(</span><span style="color:#F78C6C;">1001</span><span style="color:#A6ACCD;">)})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">局部修改</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.</span><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;">({_id:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">},{$</span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;">:{likenum:NumberInt(</span><span style="color:#F78C6C;">889</span><span style="color:#A6ACCD;">)}})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">批量修改</span></span>
<span class="line"><span style="color:#A6ACCD;">修改一条数据</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.</span><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;">({userid:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1003</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">},{$</span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;">:{nickname:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">凯撒2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">}})</span></span>
<span class="line"><span style="color:#A6ACCD;">修改所有符合条件的数据</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.</span><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;">({userid:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1003</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">},{$</span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;">:{nickname:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">凯撒大帝</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">}},{multi:true})</span></span>
<span class="line"><span style="color:#A6ACCD;">修改符合条件的第一条数据</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.</span><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;">({userid:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1003</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">},{$</span><span style="color:#F78C6C;">set</span><span style="color:#A6ACCD;">:{nickname:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">凯撒大帝</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">}})</span></span>
<span class="line"><span style="color:#A6ACCD;">列增长值修改</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.</span><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;">({_id:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">},{$inc:{likenum:NumberInt(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)}})</span></span></code></pre></div><h4 id="_5、删除文档" tabindex="-1">5、删除文档 <a class="header-anchor" href="#_5、删除文档" aria-label="Permalink to &quot;5、删除文档&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">db.集合名称.</span><span style="color:#F78C6C;">remove</span><span style="color:#A6ACCD;">(条件)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">删除全部数据</span></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.</span><span style="color:#F78C6C;">remove</span><span style="color:#A6ACCD;">({})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">db.comment.</span><span style="color:#F78C6C;">remove</span><span style="color:#A6ACCD;">({_id:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">})</span></span></code></pre></div><h4 id="_6、文档规范" tabindex="-1">6、文档规范 <a class="header-anchor" href="#_6、文档规范" aria-label="Permalink to &quot;6、文档规范&quot;">​</a></h4><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">集合如果不存在，则会隐式创建</span></span>
<span class="line"><span style="color:#A6ACCD;">mongo中的数字，默认情况下是double类型，如果要存整型，必须使用函数NumberInt(整型数字)，否则取出来就有问题了。</span></span>
<span class="line"><span style="color:#A6ACCD;">插入当前日期使用 new Date()</span></span>
<span class="line"><span style="color:#A6ACCD;">插入的数据没有指定 _id ，会自动生成主键值</span></span>
<span class="line"><span style="color:#A6ACCD;">如果某字段没值，可以赋值为null，或不写该字段。</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">文档中的键/值对是有序的。</span></span>
<span class="line"><span style="color:#A6ACCD;">文档中的值不仅可以是在双引号里面的字符串，还可以是其他几种数据类型（甚至可以是整个嵌入的文档)。</span></span>
<span class="line"><span style="color:#A6ACCD;">MongoDB区分类型和大小写。</span></span>
<span class="line"><span style="color:#A6ACCD;">MongoDB的文档不能有重复的键。</span></span>
<span class="line"><span style="color:#A6ACCD;">文档的键是字符串。除了少数例外情况，键可以使用任意UTF-8字符。</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">键不能含有\\0 (空字符)。这个字符用来表示键的结尾。</span></span>
<span class="line"><span style="color:#A6ACCD;">和$有特别的意义，只有在特定环境下才能使用。</span></span>
<span class="line"><span style="color:#A6ACCD;">以下划线&quot;_&quot;开头的键是保留的(不是严格要求的)。</span></span></code></pre></div><p>参考文档 <a href="https://blog.csdn.net/m0_65818274/article/details/134190196" target="_blank" rel="noreferrer">https://blog.csdn.net/m0_65818274/article/details/134190196</a></p><h3 id="索引操作" tabindex="-1">索引操作 <a class="header-anchor" href="#索引操作" aria-label="Permalink to &quot;索引操作&quot;">​</a></h3><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">创建索引,值1表示正序排序，</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">1表示倒序排序</span></span>
<span class="line"><span style="color:#A6ACCD;">db.userinfos.createIndex({age:</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">查看userinfos中的所有索引</span></span>
<span class="line"><span style="color:#A6ACCD;">db.userinfos.getIndexes</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">删除特定一个索引</span></span>
<span class="line"><span style="color:#A6ACCD;">db.userinfos.dropIndex({</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">,age:</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">删除所有的索引(主键索引_id不会被删除)</span></span>
<span class="line"><span style="color:#A6ACCD;">db.userinfos.dropIndexes</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">如果我们要修改一个索引的话，可以先删除索引然后在重新添加。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">索引类型</span></span>
<span class="line"><span style="color:#A6ACCD;">单键索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">.内嵌对象的某一字段作为索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    在ename.firstname字段上添加索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.createIndex({</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ename.firstname</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">    使用ename.firstname字段的索引查询</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.find({</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ename.firstname</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">san</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">.整个内嵌对象作为索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    给整个ename字段添加索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.dropIndexes</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    使用ename字段的索引查询</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.createIndex({</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ename</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">复合索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    添加复合索引，name正序，age倒序</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.createIndex({</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">,</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">age</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">}) </span></span>
<span class="line"><span style="color:#A6ACCD;">    过滤条件为name，或包含name的查询会使用索引(索引的第一个字段)</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.find({</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">张三</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">}).explain</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.find({</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">张三</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span><span style="color:#F78C6C;">level</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">}).explain</span><span style="color:#89DDFF;">()</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.find({</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">张三</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,age:</span><span style="color:#F78C6C;">23</span><span style="color:#A6ACCD;">}).explain</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">    查询条件为age时，不会使用上边创建的索引,而是使用的全表扫描</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.find({age:</span><span style="color:#F78C6C;">23</span><span style="color:#A6ACCD;">}).explain</span><span style="color:#89DDFF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">多键索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.classes.createIndex({</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">students.age</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">    造多键索引数据</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.classes.insertMany([</span></span>
<span class="line"><span style="color:#A6ACCD;">        {</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">classname</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">class1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">students</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:[{</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jack</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,age:</span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">                        {</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">tom</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,age:</span><span style="color:#F78C6C;">22</span><span style="color:#A6ACCD;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">                        {</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">lilei</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,age:</span><span style="color:#F78C6C;">25</span><span style="color:#A6ACCD;">}]</span></span>
<span class="line"><span style="color:#A6ACCD;">        },</span></span>
<span class="line"><span style="color:#A6ACCD;">        {</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">classname</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">class2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">            </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">students</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:[{</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">lucy</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,age:</span><span style="color:#F78C6C;">20</span><span style="color:#A6ACCD;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">                        {</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jim</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,age:</span><span style="color:#F78C6C;">23</span><span style="color:#A6ACCD;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">                        {</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jarry</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">,age:</span><span style="color:#F78C6C;">26</span><span style="color:#A6ACCD;">}]</span></span>
<span class="line"><span style="color:#A6ACCD;">        }]</span></span>
<span class="line"><span style="color:#A6ACCD;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">哈希索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.createIndex({</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hashed</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">}) </span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">索引属性</span></span>
<span class="line"><span style="color:#A6ACCD;">唯一索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    在userinfos的name字段添加唯一索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.createIndex({</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">},{</span><span style="color:#F78C6C;">unique</span><span style="color:#A6ACCD;">:true})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">局部索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    userinfos集合中age</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">25的部分添加age字段索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.createIndex(</span></span>
<span class="line"><span style="color:#A6ACCD;">        {age:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">        { partialFilterExpression: {age:{$gt: </span><span style="color:#F78C6C;">25</span><span style="color:#A6ACCD;"> }}}</span></span>
<span class="line"><span style="color:#A6ACCD;">    )</span></span>
<span class="line"><span style="color:#A6ACCD;">    查询age</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">25的document时，因为age</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">25的部分没有索引，会全表扫描查找(stage:COLLSCAN)</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.find({age:</span><span style="color:#F78C6C;">23</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"><span style="color:#A6ACCD;">    查询age</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">25的document时，因为age</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">25的部分创建了索引，会使用索引进行查找(stage:IXSCAN)</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.userinfos.find({age:</span><span style="color:#F78C6C;">26</span><span style="color:#A6ACCD;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">稀疏索引</span></span>
<span class="line"><span style="color:#A6ACCD;">　　db.userinfos.createIndex({</span><span style="color:#F78C6C;">address</span><span style="color:#A6ACCD;">:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">},{sparse:true})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">TTL索引</span></span>
<span class="line"><span style="color:#A6ACCD;">    添加测试数据</span></span>
<span class="line"><span style="color:#A6ACCD;">    db.logs.insertMany([</span></span>
<span class="line"><span style="color:#A6ACCD;">       {_id:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">,createtime:new </span><span style="color:#C792EA;">Date</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">,msg:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">log1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">       {_id:</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">,createtime:new </span><span style="color:#C792EA;">Date</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">,msg:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">log2</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">       {_id:</span><span style="color:#F78C6C;">3</span><span style="color:#A6ACCD;">,createtime:new </span><span style="color:#C792EA;">Date</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">,msg:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">log3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">       {_id:</span><span style="color:#F78C6C;">4</span><span style="color:#A6ACCD;">,createtime:new </span><span style="color:#C792EA;">Date</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">,msg:</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">log4</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">       ])</span></span>
<span class="line"><span style="color:#A6ACCD;">       </span><span style="color:#89DDFF;">//</span><span style="color:#A6ACCD;">在createtime字段添加TTL索引，过期时间是120s</span></span>
<span class="line"><span style="color:#A6ACCD;">       db.logs.createIndex({createtime:</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">}, { expireAfterSeconds: </span><span style="color:#F78C6C;">120</span><span style="color:#A6ACCD;"> })</span></span>
<span class="line"><span style="color:#A6ACCD;">    logs中的document在创建后的120s后过期，会被mongoDB自动删除</span></span></code></pre></div><p>单键索引 <img src="`+o+'" alt="alt text"> 复合索引 <img src="'+p+'" alt="alt text"> 多键索引 <img src="'+e+'" alt="alt text"> 哈希索引 <img src="'+t+'" alt="alt text"></p><p>唯一索引 <img src="'+c+'" alt="alt text"> 局部索引 <img src="'+r+'" alt="alt text"> 稀疏索引 <img src="'+C+`" alt="alt text"></p><p>参考文档 <a href="https://www.cnblogs.com/wyy1234/p/11032163.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/wyy1234/p/11032163.html</a></p><h2 id="事务" tabindex="-1">事务 <a class="header-anchor" href="#事务" aria-label="Permalink to &quot;事务&quot;">​</a></h2><p>在 MongoDB 中，对单个文档的操作都是原子的。因为可以在单个文档结构中使用内嵌文档和数据获得数据之间的关系，所以不必跨多个文档和集合进行范式化，这种 结构特性，避免了很多场景中的对多文档事务的需求。</p><p>对于需要多个文档进行原子读写的场景，MongoDB 中引入了多文档事务和分布式事务。</p><p>在4.0版本中，MongoDB支持副本集上的多文档事务；</p><p>在4.2版本中，MongoDB 引入了分布式事务，增加了对分片集群上多文档事务的支持，并合并了对副本集上多文档事务的现有支持，事务可以跨多个操作、集合、数据库、文档和分片使用，这种方式事务的实现主要是借助于两阶段提交协议（2PC）实现的。</p><h2 id="索引" tabindex="-1">索引 <a class="header-anchor" href="#索引" aria-label="Permalink to &quot;索引&quot;">​</a></h2><h3 id="类型" tabindex="-1">类型 <a class="header-anchor" href="#类型" aria-label="Permalink to &quot;类型&quot;">​</a></h3><h4 id="单列索引" tabindex="-1">单列索引 <a class="header-anchor" href="#单列索引" aria-label="Permalink to &quot;单列索引&quot;">​</a></h4><h4 id="复合索引" tabindex="-1">复合索引 <a class="header-anchor" href="#复合索引" aria-label="Permalink to &quot;复合索引&quot;">​</a></h4><h4 id="多键索引" tabindex="-1">多键索引 <a class="header-anchor" href="#多键索引" aria-label="Permalink to &quot;多键索引&quot;">​</a></h4><p>在文档中有些字段是数组，为了提高这些数组查询效率，提供了多键索引</p><h4 id="哈希索引" tabindex="-1">哈希索引 <a class="header-anchor" href="#哈希索引" aria-label="Permalink to &quot;哈希索引&quot;">​</a></h4><p>哈希索引(hashed Indexes)就是将field的值进行hash计算后作为索引，其强大之处在于实现O(1)查找，当然用哈希索引最主要的功能也就是实现定值查找，对于经常需要排序或查询范围查询的集合不要使用哈希索引。</p><h3 id="属性" tabindex="-1">属性 <a class="header-anchor" href="#属性" aria-label="Permalink to &quot;属性&quot;">​</a></h3><h4 id="唯一索引" tabindex="-1">唯一索引 <a class="header-anchor" href="#唯一索引" aria-label="Permalink to &quot;唯一索引&quot;">​</a></h4><p>唯一索引(unique indexes)用于为collection添加唯一约束，即强制要求collection中的索引字段没有重复值。添加唯一索引的语法：</p><h4 id="局部索引" tabindex="-1">局部索引 <a class="header-anchor" href="#局部索引" aria-label="Permalink to &quot;局部索引&quot;">​</a></h4><p>局部索引(Partial Indexes)顾名思义，只对collection的一部分添加索引。创建索引的时候，根据过滤条件判断是否对document添加索引，对于没有添加索引的文档查找时采用的全表扫描，对添加了索引的文档查找时使用索引。</p><h4 id="稀疏索引" tabindex="-1">稀疏索引 <a class="header-anchor" href="#稀疏索引" aria-label="Permalink to &quot;稀疏索引&quot;">​</a></h4><p>稀疏索引(sparse indexes)在有索引字段的document上添加索引，如在address字段上添加稀疏索引时，只有document有address字段时才会添加索引。而普通索引则是为所有的document添加索引，使用普通索引时如果document没有索引字段的话，设置索引字段的值为null。</p><h4 id="ttl索引" tabindex="-1">TTL索引 <a class="header-anchor" href="#ttl索引" aria-label="Permalink to &quot;TTL索引&quot;">​</a></h4><p>TTL索引(TTL indexes)是一种特殊的单键索引，用于设置document的过期时间，mongoDB会在document过期后将其删除，TTL非常容易实现类似缓存过期策略的功能</p><h2 id="底层原理" tabindex="-1">底层原理 <a class="header-anchor" href="#底层原理" aria-label="Permalink to &quot;底层原理&quot;">​</a></h2><h2 id="java中使用mongodb" tabindex="-1">JAVA中使用mongodb <a class="header-anchor" href="#java中使用mongodb" aria-label="Permalink to &quot;JAVA中使用mongodb&quot;">​</a></h2><div class="language-java"><button title="Copy Code" class="copy"></button><span class="lang">java</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">@</span><span style="color:#C792EA;">Autowired</span></span>
<span class="line"><span style="color:#C792EA;">protected</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">MongoTemplate</span><span style="color:#A6ACCD;"> mongoTemplate</span><span style="color:#89DDFF;">;</span></span></code></pre></div>`,91),A=[y];function i(F,d,u,q,h,m){return a(),n("div",null,A)}const f=s(D,[["render",i]]);export{g as __pageData,f as default};
