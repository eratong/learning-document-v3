import{_ as s,o as a,c as n,X as l}from"./chunks/framework.9bc23fa4.js";const d=JSON.parse('{"title":"postgresql","description":"","frontmatter":{},"headers":[],"relativePath":"data/后端/数据库/postgresql.md","filePath":"data/后端/数据库/postgresql.md","lastUpdated":1720420715000}'),o={name:"data/后端/数据库/postgresql.md"},p=l(`<h1 id="postgresql" tabindex="-1">postgresql <a class="header-anchor" href="#postgresql" aria-label="Permalink to &quot;postgresql&quot;">​</a></h1><h2 id="基础" tabindex="-1">基础 <a class="header-anchor" href="#基础" aria-label="Permalink to &quot;基础&quot;">​</a></h2><p>开源关系数据库，支持非关系和关系数据类型</p><h3 id="源码-c" tabindex="-1">源码(C) <a class="header-anchor" href="#源码-c" aria-label="Permalink to &quot;源码(C)&quot;">​</a></h3><h3 id="默认端口5432" tabindex="-1">默认端口5432 <a class="header-anchor" href="#默认端口5432" aria-label="Permalink to &quot;默认端口5432&quot;">​</a></h3><h3 id="使用场景" tabindex="-1">使用场景 <a class="header-anchor" href="#使用场景" aria-label="Permalink to &quot;使用场景&quot;">​</a></h3><p>参考文档</p><p>中文社区 <a href="http://www.postgres.cn/v2/document" target="_blank" rel="noreferrer">http://www.postgres.cn/v2/document</a></p><p><a href="https://www.postgresql.org/docs/" target="_blank" rel="noreferrer">https://www.postgresql.org/docs/</a></p><h3 id="目录结构" tabindex="-1">目录结构 <a class="header-anchor" href="#目录结构" aria-label="Permalink to &quot;目录结构&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">find . -type f -name &quot;*postgres*&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">cd /var/lib/postgresql/data</span></span>
<span class="line"><span style="color:#A6ACCD;"></span></span>
<span class="line"><span style="color:#A6ACCD;">-bash-4.2$ tree -L 1 -d /var/lib/postgresql/data</span></span>
<span class="line"><span style="color:#A6ACCD;">/var/lib/postgresql/data              --数据目录</span></span>
<span class="line"><span style="color:#A6ACCD;">├── base                              --表和索引文件存放目录</span></span>
<span class="line"><span style="color:#A6ACCD;">├── global                            --影响全局的系统表存放目录</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_commit_ts                      --事务提交时间戳数据存放目录</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_dynshmem                       --被动态共享所使用的文件存放目录</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_logical                        --用于逻辑复制的状态数据</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_multixact                      --多事务状态的数据</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_notify                         --LISTEN/NOTIFY状态的数据</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_replslot                       --复制槽数据存放目录</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_serial                         --已提交的可序列化信息存放目录</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_snapshots                      --快照</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_stat                           --统计信息</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_stat_tmp                       --统计信息子系统临时文件</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_subtrans                       --子事务状态数据</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_tblspc                         --表空间</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_twophase                       --预备事务状态文件</span></span>
<span class="line"><span style="color:#A6ACCD;">├── pg_wal                            --事务日志（预写日志）</span></span>
<span class="line"><span style="color:#A6ACCD;">└── pg_xact                           --日志提交状态的数据存放目录</span></span></code></pre></div><h3 id="表类型" tabindex="-1">表类型 <a class="header-anchor" href="#表类型" aria-label="Permalink to &quot;表类型&quot;">​</a></h3><p>在 PostgreSQL 中，你可以使用常规表、外部表和分区表来存储数据。这三种表的概念如下：</p><p>常规表：常规表是最基本的表类型，在 PostgreSQL 中通常使用的表就是常规表。它们存储在数据库的默认表空间中，数据被存储在数据库服务器的数据目录中。</p><p>外部表：外部表是一种特殊的表，它并不实际存储数据，而是提供了对外部数据源的访问。外部表的数据可以是位于远程服务器上的文件、其他数据库的表、Hadoop HDFS 中的数据等。外部表提供了一种透明访问外部数据源的方式，使得可以在 PostgreSQL 中像访问常规表一样查询外部数据。</p><p>分区表：分区表是将表数据按照某种规则分成多个子表进行存储的一种表类型。这样做的目的是可以更高效地管理和查询大量数据。例如，可以按照时间范围或者其他业务逻辑来分区，每个分区可以独立进行维护和查询，从而提高了查询性能和管理效率。</p><h3 id="数据类型" tabindex="-1">数据类型 <a class="header-anchor" href="#数据类型" aria-label="Permalink to &quot;数据类型&quot;">​</a></h3><h4 id="数值类型" tabindex="-1">数值类型 <a class="header-anchor" href="#数值类型" aria-label="Permalink to &quot;数值类型&quot;">​</a></h4><ul><li><p><strong>整数类型</strong></p><ul><li><code>smallint</code>: 2字节，范围 -32,768 到 32,767</li><li><code>integer</code> 或 <code>int</code>: 4字节，范围 -2,147,483,648 到 2,147,483,647</li><li><code>bigint</code>: 8字节，范围 -9,223,372,036,854,775,808 到 9,223,372,036,854,775,807</li><li><code>serial</code>: 自动增长的4字节整数（相当于<code>integer</code> + 自增)</li><li><code>bigserial</code>: 自动增长的8字节整数（相当于<code>bigint</code> + 自增)</li></ul></li><li><p><strong>精确数值</strong></p><ul><li><code>numeric(p, s)</code>: 可变精度和小数位数的数值</li><li><code>decimal(p, s)</code>: <code>numeric</code>的别名</li></ul></li><li><p><strong>浮点数类型</strong></p><ul><li><code>real</code>: 4字节，单精度浮点数</li><li><code>double precision</code>: 8字节，双精度浮点数</li></ul></li></ul><h4 id="字符串类型" tabindex="-1">字符串类型 <a class="header-anchor" href="#字符串类型" aria-label="Permalink to &quot;字符串类型&quot;">​</a></h4><ul><li><strong>字符类型</strong><ul><li><code>char(n)</code>: 固定长度字符类型</li><li><code>varchar(n)</code>: 可变长度字符类型，最多 <code>n</code> 字符</li><li><code>text</code>: 可变不限长度的字符类型</li></ul></li></ul><h4 id="日期和时间类型" tabindex="-1">日期和时间类型 <a class="header-anchor" href="#日期和时间类型" aria-label="Permalink to &quot;日期和时间类型&quot;">​</a></h4><p>如果您处理的是本地时间，而不关心其与全球标准时间（UTC）的关系，则可以使用不带时区的日期/时间类型。</p><ul><li><code>date</code>: 日期类型（年、月、日）</li><li><code>time [ (p) ] [ without time zone ]</code>: 时间类型（无时区）</li><li><code>time [ (p) ] with time zone</code>: 时间类型（带时区）</li><li><code>timestamp [ (p) ] [ without time zone ]</code>: 时间戳类型（日期和时间，带可选精度）</li><li><code>timestamp [ (p) ] with time zone</code>: 带时区的时间戳类型</li><li><code>interval</code>: 时间间隔类型（用于表示两个时间点之间的差值）</li></ul><h4 id="布尔类型" tabindex="-1">布尔类型 <a class="header-anchor" href="#布尔类型" aria-label="Permalink to &quot;布尔类型&quot;">​</a></h4><ul><li><code>boolean</code>: 布尔类型，取值为 <code>TRUE</code>、<code>FALSE</code> 或 <code>NULL</code></li></ul><h4 id="枚举类型" tabindex="-1">枚举类型 <a class="header-anchor" href="#枚举类型" aria-label="Permalink to &quot;枚举类型&quot;">​</a></h4><ul><li><code>enum</code>: 枚举类型，用户自定义类型，用于定义一组有序值</li></ul><h4 id="二进制类型" tabindex="-1">二进制类型 <a class="header-anchor" href="#二进制类型" aria-label="Permalink to &quot;二进制类型&quot;">​</a></h4><ul><li><code>bytea</code>: 可变长度的二进制字符串</li></ul><h4 id="uuid类型" tabindex="-1">UUID类型 <a class="header-anchor" href="#uuid类型" aria-label="Permalink to &quot;UUID类型&quot;">​</a></h4><ul><li><code>uuid</code>: 通用唯一标识符</li></ul><h4 id="网络地址类型" tabindex="-1">网络地址类型 <a class="header-anchor" href="#网络地址类型" aria-label="Permalink to &quot;网络地址类型&quot;">​</a></h4><ul><li><code>cidr</code>: IPv4 或 IPv6 网络</li><li><code>inet</code>: IPv4 或 IPv6 主机地址</li><li><code>macaddr</code>: MAC 地址</li><li><code>macaddr8</code>: EUI-64 MAC 地址</li></ul><h4 id="其他类型" tabindex="-1">其他类型 <a class="header-anchor" href="#其他类型" aria-label="Permalink to &quot;其他类型&quot;">​</a></h4><ul><li><strong>货币类型</strong><ul><li><code>money</code>: 货币金额（带有货币符号的数字）</li></ul></li><li><strong>几何类型</strong><ul><li><code>point</code>: 一个点，包含 x 和 y 坐标</li><li><code>line</code>: 无限长的直线</li><li><code>lseg</code>: 线段</li><li><code>box</code>: 矩形</li><li><code>path</code>: 路径（开放或封闭）</li><li><code>polygon</code>: 多边形</li><li><code>circle</code>: 圆</li></ul></li><li><strong>文本搜索类型</strong><ul><li><code>tsvector</code>: 文本向量</li><li><code>tsquery</code>: 文本查询</li></ul></li><li><strong>JSON数据类型</strong><ul><li><code>json</code>: 文本格式的JSON数据</li><li><code>jsonb</code>: 二进制格式的JSON数据，带有索引支持</li></ul></li><li><strong>数组类型</strong><ul><li>PostgreSQL支持几乎所有基本数据类型的数组，例如：<code>integer[]</code>, <code>text[]</code>等</li></ul></li><li><strong>范围类型</strong><ul><li><code>int4range</code>: <code>integer</code>范围</li><li><code>int8range</code>: <code>bigint</code>范围</li><li><code>numrange</code>: <code>numeric</code>范围</li><li><code>tsrange</code>: <code>timestamp without time zone</code>范围</li><li><code>tstzrange</code>: <code>timestamp with time zone</code>范围</li><li><code>daterange</code>: <code>date</code>范围</li></ul></li></ul><h4 id="自定义类型" tabindex="-1">自定义类型 <a class="header-anchor" href="#自定义类型" aria-label="Permalink to &quot;自定义类型&quot;">​</a></h4><ul><li><strong>复合类型</strong>：用户可以定义自己的复合数据类型，类似于C语言中的结构体。</li><li><strong>域类型</strong>：基于现有类型创建带有约束的域。</li></ul><p>参考文档 <a href="https://www.runoob.com/postgresql/postgresql-data-type.html" target="_blank" rel="noreferrer">https://www.runoob.com/postgresql/postgresql-data-type.html</a></p><h2 id="常用语句" tabindex="-1">常用语句 <a class="header-anchor" href="#常用语句" aria-label="Permalink to &quot;常用语句&quot;">​</a></h2><h3 id="postgresql操作" tabindex="-1">postgresql操作 <a class="header-anchor" href="#postgresql操作" aria-label="Permalink to &quot;postgresql操作&quot;">​</a></h3><h4 id="_1、当前总共正在使用的连接数" tabindex="-1">1、当前总共正在使用的连接数 <a class="header-anchor" href="#_1、当前总共正在使用的连接数" aria-label="Permalink to &quot;1、当前总共正在使用的连接数&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">count</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">) </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> pg_stat_activity;</span></span></code></pre></div><h4 id="_2、查看版本" tabindex="-1">2、查看版本 <a class="header-anchor" href="#_2、查看版本" aria-label="Permalink to &quot;2、查看版本&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">version</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;">;</span></span></code></pre></div><h3 id="数据库操作" tabindex="-1">数据库操作 <a class="header-anchor" href="#数据库操作" aria-label="Permalink to &quot;数据库操作&quot;">​</a></h3><h4 id="_1、终止执行语句" tabindex="-1">1、终止执行语句 <a class="header-anchor" href="#_1、终止执行语句" aria-label="Permalink to &quot;1、终止执行语句&quot;">​</a></h4><p>第一种pg_cancel_backend,这种方式只能kill select查询，对update、delete 及DML不生效)</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> pg_cancel_backend(PID);</span></span></code></pre></div><p>第二种pg_terminate_backend,这种可以kill掉各种操作(select、update、delete、drop等)操作</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> pg_terminate_backend(PID);</span></span></code></pre></div><h4 id="_2、查看语句执行计划-explain" tabindex="-1">2、查看语句执行计划 explain <a class="header-anchor" href="#_2、查看语句执行计划-explain" aria-label="Permalink to &quot;2、查看语句执行计划 explain&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">一、执行计划参数</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPLAIN</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">public</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sys_operate_log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">public</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sys_operate_log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">.log_id </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">LIMIT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;"> OFFSET </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">Limit</span><span style="color:#A6ACCD;">  (cost</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">..</span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">rows</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> width</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">596</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">-&gt;</span><span style="color:#A6ACCD;">  Seq Scan </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> sys_operate_log  (cost</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">..</span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">30</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">rows</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> width</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">596</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F78C6C;">Filter</span><span style="color:#A6ACCD;">: ((log_id)::</span><span style="color:#C792EA;">text</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">::</span><span style="color:#C792EA;">text</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">多个像这样写</span></span>
<span class="line"><span style="color:#A6ACCD;">EXPLAIN (</span><span style="color:#F78C6C;">VERBOSE</span><span style="color:#A6ACCD;">, ANALYZE)</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">FROM</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">public</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sys_operate_log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">WHERE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">public</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sys_operate_log</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">.log_id </span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">LIMIT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1000</span><span style="color:#A6ACCD;"> OFFSET </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">EXPLAIN ANALYZE [ boolean ] </span></span>
<span class="line"><span style="color:#A6ACCD;">实际执行SQL获取实际的执行计划</span></span>
<span class="line"><span style="color:#A6ACCD;">ANALYZE 选项为TRUE 会实际执行SQL，并获得相应的查询计划，默认为FALSE。如果优化一些修改数据的SQL 需要真实的执行但是不能影响现有的数据，可以放在一个事务中，分析完成后可以直接回滚。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">EXPLAIN </span><span style="color:#F78C6C;">VERBOSE</span><span style="color:#A6ACCD;"> [ boolean ]</span></span>
<span class="line"><span style="color:#F78C6C;">VERBOSE</span><span style="color:#A6ACCD;"> 选项为TRUE 会显示查询计划的附加信息，默认为FALSE。附加信息包括查询计划中每个节点（后面具体解释节点的含义）输出的列（</span><span style="color:#F78C6C;">Output</span><span style="color:#A6ACCD;">），表的SCHEMA 信息，函数的SCHEMA 信息，表达式中列所属表的别名，被触发的触发器名称等。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">EXPLAIN COSTS [ boolean ]</span></span>
<span class="line"><span style="color:#A6ACCD;">COSTS 选项为TRUE 会显示每个计划节点的预估启动代价（找到第一个符合条件的结果的代价）和总代价，以及预估行数和每行宽度，默认为TRUE。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">EXPLAIN BUFFERS [ boolean ]</span></span>
<span class="line"><span style="color:#A6ACCD;">BUFFERS 选项为TRUE 会显示关于缓存的使用信息，默认为FALSE。该参数只能与ANALYZE 参数一起使用。缓冲区信息包括共享块（常规表或者索引块）、本地块（临时表或者索引块）和临时块（排序或者哈希等涉及到的短期存在的数据块）的命中块数，更新块数，挤出块数。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">EXPLAIN TIMING [ boolean ]</span></span>
<span class="line"><span style="color:#A6ACCD;">TIMING 选项为TRUE 会显示每个计划节点的实际启动时间和总的执行时间，默认为TRUE。该参数只能与ANALYZE 参数一起使用。因为对于一些系统来说，获取系统时间需要比较大的代价，如果只需要准确的返回行数，而不需要准确的时间，可以把该参数关闭。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">EXPLAIN SUMMARY [ boolean ]</span></span>
<span class="line"><span style="color:#A6ACCD;">SUMMARY 选项为TRUE 会在查询计划后面输出总结信息，例如查询计划生成的时间和查询计划执行的时间。当ANALYZE 选项打开时，它默认为TRUE。</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">EXPLAIN FORMAT { </span><span style="color:#C792EA;">TEXT</span><span style="color:#A6ACCD;"> | </span><span style="color:#F78C6C;">XML</span><span style="color:#A6ACCD;"> | </span><span style="color:#F78C6C;">JSON</span><span style="color:#A6ACCD;"> | YAML }</span></span>
<span class="line"><span style="color:#A6ACCD;">FORMAT 指定输出格式，默认为TEXT。各个格式输出的内容都是相同的，其中XML | </span><span style="color:#F78C6C;">JSON</span><span style="color:#A6ACCD;"> | YAML 更有利于我们通过程序解析SQL 语句的查询计划，为了更有利于阅读，我们下文的例子都是使用TEXT 格式的输出结果。</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">二、扫描方式</span></span>
<span class="line"><span style="color:#A6ACCD;">Seq Scan </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> pg_table_test  (cost</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">..</span><span style="color:#F78C6C;">1935</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">rows</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">100000</span><span style="color:#A6ACCD;"> width</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">Seq Scan 表示全表扫描（顺序扫描）cost</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">..</span><span style="color:#F78C6C;">1935</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">rows</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">100000</span><span style="color:#A6ACCD;"> width</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;"> 表示查询消耗的成本以及返回行数</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">简单来说</span></span>
<span class="line"><span style="color:#A6ACCD;">全表扫描 Seq Scan</span></span>
<span class="line"><span style="color:#A6ACCD;">索引扫描 </span><span style="color:#F78C6C;">Index</span><span style="color:#A6ACCD;"> Scan</span></span>
<span class="line"><span style="color:#A6ACCD;">位图扫描 Bitmap Heap Scan</span></span>
<span class="line"><span style="color:#A6ACCD;">  位图扫描也是走索引的方式，方法是扫描索引，把满足条件的行或块在内存中建一个位图，扫描完索引后，再根据位图到表的数据文件中把相应的数据读出来。如果走了两个索引，可以把两个索引形成的位图通过 </span><span style="color:#F78C6C;">AND</span><span style="color:#A6ACCD;"> 或 </span><span style="color:#F78C6C;">OR</span><span style="color:#A6ACCD;"> 计算合并成一个，再到表的数据文件中把数据读出来。</span></span>
<span class="line"><span style="color:#A6ACCD;">条件过滤 </span><span style="color:#F78C6C;">filter</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">总的来说</span></span>
<span class="line"><span style="color:#A6ACCD;">Seq Scan，顺序扫描</span></span>
<span class="line"><span style="color:#F78C6C;">Index</span><span style="color:#A6ACCD;"> Scan，基于索引扫描，但不只是返回索引列的值</span></span>
<span class="line"><span style="color:#A6ACCD;">IndexOnly Scan，基于索引扫描，并且只返回索引列的值，简称为覆盖索引</span></span>
<span class="line"><span style="color:#A6ACCD;">BitmapIndex Scan，利用Bitmap 结构扫描</span></span>
<span class="line"><span style="color:#A6ACCD;">BitmapHeap Scan，把BitmapIndex Scan 返回的Bitmap 结构转换为元组结构</span></span>
<span class="line"><span style="color:#A6ACCD;">Tid Scan，用于扫描一个元组TID 数组</span></span>
<span class="line"><span style="color:#A6ACCD;">Subquery Scan，扫描一个子查询</span></span>
<span class="line"><span style="color:#F78C6C;">Function</span><span style="color:#A6ACCD;"> Scan，处理含有函数的扫描</span></span>
<span class="line"><span style="color:#A6ACCD;">TableFunc Scan，处理tablefunc 相关的扫描</span></span>
<span class="line"><span style="color:#F78C6C;">Values</span><span style="color:#A6ACCD;"> Scan，用于扫描Values 链表的扫描</span></span>
<span class="line"><span style="color:#A6ACCD;">Cte Scan，用于扫描WITH 字句的结果集</span></span>
<span class="line"><span style="color:#A6ACCD;">NamedTuplestore Scan，用于某些命名的结果集的扫描</span></span>
<span class="line"><span style="color:#A6ACCD;">WorkTable Scan，用于扫描Recursive </span><span style="color:#F78C6C;">Union</span><span style="color:#A6ACCD;"> 的中间数据</span></span>
<span class="line"><span style="color:#A6ACCD;">Foreign Scan，用于外键扫描</span></span>
<span class="line"><span style="color:#A6ACCD;">Custom Scan，用于用户自定义的扫描</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">explain(ANALYZE,</span><span style="color:#F78C6C;">VERBOSE</span><span style="color:#A6ACCD;">,BUFFERS) </span><span style="color:#F78C6C;">select</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">from</span><span style="color:#A6ACCD;"> class </span><span style="color:#F78C6C;">where</span><span style="color:#A6ACCD;"> st_no</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">                                               QUERY PLAN</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;">--------------------------------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#A6ACCD;"> Seq Scan </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> public.class  (cost</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">..</span><span style="color:#F78C6C;">26</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">rows</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> width</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">35</span><span style="color:#A6ACCD;">) (actual </span><span style="color:#C792EA;">time</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">136</span><span style="color:#A6ACCD;">..</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">141</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">rows</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> loops</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F78C6C;">Output</span><span style="color:#A6ACCD;">: st_no, </span><span style="color:#F78C6C;">name</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F78C6C;">Filter</span><span style="color:#A6ACCD;">: (class.st_no </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">   </span><span style="color:#F78C6C;">Rows</span><span style="color:#A6ACCD;"> Removed </span><span style="color:#F78C6C;">by</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">Filter</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">1199</span></span>
<span class="line"><span style="color:#A6ACCD;">   Buffers: shared hit</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">11</span></span>
<span class="line"><span style="color:#A6ACCD;"> Planning </span><span style="color:#C792EA;">time</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">066</span><span style="color:#A6ACCD;"> ms</span></span>
<span class="line"><span style="color:#A6ACCD;"> Execution </span><span style="color:#C792EA;">time</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">160</span><span style="color:#A6ACCD;"> ms</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">Seq Scan </span><span style="color:#F78C6C;">on</span><span style="color:#A6ACCD;"> public.class 表明了这个节点的类型和作用对象，即在class 表上进行了全表扫描 | (cost</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;">..</span><span style="color:#F78C6C;">26</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">00</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">rows</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> width</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">35</span><span style="color:#A6ACCD;">) 表明了这个节点的代价估计，这部分我们将在下文节点代价估计信息中详细介绍 | (actual </span><span style="color:#C792EA;">time</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">136</span><span style="color:#A6ACCD;">..</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">141</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">rows</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> loops</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">) 表明了这个节点的真实执行信息，当E</span></span>
<span class="line"><span style="color:#F78C6C;">Output</span><span style="color:#A6ACCD;">: st_no, </span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;"> 表明了SQL 的输出结果集的各个列，当EXPLAIN 命令中的选项VERBOSE 为on时才会显示</span></span>
<span class="line"><span style="color:#F78C6C;">Filter</span><span style="color:#A6ACCD;">: (class.st_no </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">) 表明了Seq Scan 节点之上的Filter 操作，即全表扫描时对每行记录进行过滤操作，过滤条件为class.st_no </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span></span>
<span class="line"><span style="color:#F78C6C;">Rows</span><span style="color:#A6ACCD;"> Removed </span><span style="color:#F78C6C;">by</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">Filter</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">1199</span><span style="color:#A6ACCD;"> 表明了过滤操作过滤了多少行记录，属于Seq Scan 节点的VERBOSE 信息，只有EXPLAIN 命令中的VERBOSE 选项为on 时才会显示</span></span>
<span class="line"><span style="color:#A6ACCD;">Buffers: shared hit</span><span style="color:#89DDFF;">=</span><span style="color:#F78C6C;">11</span><span style="color:#A6ACCD;"> 表明了从共享缓存中命中了11 个BLOCK，属于Seq Scan 节点的BUFFERS 信息，只有EXPLAIN 命令中的BUFFERS 选项为on 时才会显示</span></span>
<span class="line"><span style="color:#A6ACCD;">Planning </span><span style="color:#C792EA;">time</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">066</span><span style="color:#A6ACCD;"> ms 表明了生成查询计划的时间</span></span>
<span class="line"><span style="color:#A6ACCD;">Execution </span><span style="color:#C792EA;">time</span><span style="color:#A6ACCD;">: </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">.</span><span style="color:#F78C6C;">160</span><span style="color:#A6ACCD;"> ms 表明了实际的SQL 执行时间，其中不包括查询计划的生成时间</span></span></code></pre></div><p>参考文档<br><a href="https://www.postgresql.org/docs/10/using-explain.html" target="_blank" rel="noreferrer">https://www.postgresql.org/docs/10/using-explain.html</a></p><p><a href="https://juejin.cn/post/6960674004969455623" target="_blank" rel="noreferrer">https://juejin.cn/post/6960674004969455623</a></p><h4 id="_3、建库" tabindex="-1">3、建库 <a class="header-anchor" href="#_3、建库" aria-label="Permalink to &quot;3、建库&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">DATABASE</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">tong</span><span style="color:#A6ACCD;">;</span></span></code></pre></div><h4 id="_4、查询事务隔离级别" tabindex="-1">4、查询事务隔离级别 <a class="header-anchor" href="#_4、查询事务隔离级别" aria-label="Permalink to &quot;4、查询事务隔离级别&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">SHOW transaction_isolation;</span></span></code></pre></div><h3 id="表操作" tabindex="-1">表操作 <a class="header-anchor" href="#表操作" aria-label="Permalink to &quot;表操作&quot;">​</a></h3><h4 id="_1、创建表" tabindex="-1">1、创建表 <a class="header-anchor" href="#_1、创建表" aria-label="Permalink to &quot;1、创建表&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> &quot;</span><span style="color:#82AAFF;">public</span><span style="color:#A6ACCD;">&quot;.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">user_info</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> int8 </span><span style="color:#F78C6C;">NOT NULL</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">255</span><span style="color:#A6ACCD;">) </span><span style="color:#C792EA;">COLLATE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pg_catalog</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">default</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sex</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> int2,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">create_time</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">timestamp</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">update_time</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">timestamp</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">6</span><span style="color:#A6ACCD;">),</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">is_deleted</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> int2 </span><span style="color:#C792EA;">DEFAULT</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">CONSTRAINT</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">user_pkey</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">PRIMARY KEY</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">ALTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">public</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">user_info</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F78C6C;">OWNER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TO</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">postgres</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">COMMENT ON COLUMN &quot;public&quot;.&quot;user_info&quot;.&quot;id&quot; IS </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">主键</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">COMMENT ON COLUMN &quot;public&quot;.&quot;user_info&quot;.&quot;name&quot; IS </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">姓名</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">COMMENT ON COLUMN &quot;public&quot;.&quot;user_info&quot;.&quot;sex&quot; IS </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">性别 0女 1男</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">COMMENT ON COLUMN &quot;public&quot;.&quot;user_info&quot;.&quot;create_time&quot; IS </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">创建时间</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">COMMENT ON COLUMN &quot;public&quot;.&quot;user_info&quot;.&quot;update_time&quot; IS </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">修改时间</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F78C6C;">COMMENT ON COLUMN &quot;public&quot;.&quot;user_info&quot;.&quot;is_deleted&quot; IS </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">是否删除 0 否 1 是</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">;</span></span></code></pre></div><h4 id="_2、添加索引" tabindex="-1">2、添加索引 <a class="header-anchor" href="#_2、添加索引" aria-label="Permalink to &quot;2、添加索引&quot;">​</a></h4><h5 id="_1-唯一索引" tabindex="-1">① 唯一索引 <a class="header-anchor" href="#_1-唯一索引" aria-label="Permalink to &quot;① 唯一索引&quot;">​</a></h5><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">UNIQUE INDEX</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">idx_unique_name</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> public.user_info (</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">);</span></span></code></pre></div><h5 id="_2-单列索引" tabindex="-1">② 单列索引 <a class="header-anchor" href="#_2-单列索引" aria-label="Permalink to &quot;② 单列索引&quot;">​</a></h5><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">INDEX</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">idx_sex</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> public.user_info (sex);</span></span></code></pre></div><h5 id="_3-多列索引" tabindex="-1">③ 多列索引 <a class="header-anchor" href="#_3-多列索引" aria-label="Permalink to &quot;③ 多列索引&quot;">​</a></h5><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">CREATE</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">INDEX</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">idx_name_sex</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">ON</span><span style="color:#A6ACCD;"> public.user_info (</span><span style="color:#F78C6C;">name</span><span style="color:#A6ACCD;">, sex);</span></span></code></pre></div><h5 id="_4-函数索引" tabindex="-1">④ 函数索引 <a class="header-anchor" href="#_4-函数索引" aria-label="Permalink to &quot;④ 函数索引&quot;">​</a></h5><h5 id="_5-部分索引" tabindex="-1">⑤ 部分索引 <a class="header-anchor" href="#_5-部分索引" aria-label="Permalink to &quot;⑤ 部分索引&quot;">​</a></h5><h5 id="_6-覆盖索引" tabindex="-1">⑥ 覆盖索引 <a class="header-anchor" href="#_6-覆盖索引" aria-label="Permalink to &quot;⑥ 覆盖索引&quot;">​</a></h5><h4 id="_3、表修改名字" tabindex="-1">3、表修改名字 <a class="header-anchor" href="#_3、表修改名字" aria-label="Permalink to &quot;3、表修改名字&quot;">​</a></h4><h4 id="_4、表添加字段" tabindex="-1">4、表添加字段 <a class="header-anchor" href="#_4、表添加字段" aria-label="Permalink to &quot;4、表添加字段&quot;">​</a></h4><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">ALTER</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">TABLE</span><span style="color:#A6ACCD;"> user_info </span><span style="color:#F78C6C;">ADD</span><span style="color:#A6ACCD;"> COLUMN context </span><span style="color:#C792EA;">varchar</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">255</span><span style="color:#A6ACCD;">);</span></span></code></pre></div><h4 id="_5、表修改字段名字" tabindex="-1">5、表修改字段名字 <a class="header-anchor" href="#_5、表修改字段名字" aria-label="Permalink to &quot;5、表修改字段名字&quot;">​</a></h4><h4 id="_6、查询" tabindex="-1">6、查询 <a class="header-anchor" href="#_6、查询" aria-label="Permalink to &quot;6、查询&quot;">​</a></h4><h4 id="_7、表联查" tabindex="-1">7、表联查 <a class="header-anchor" href="#_7、表联查" aria-label="Permalink to &quot;7、表联查&quot;">​</a></h4><p>-- 问题 -- 1. 自增问题</p><h3 id="存储过程" tabindex="-1">存储过程 <a class="header-anchor" href="#存储过程" aria-label="Permalink to &quot;存储过程&quot;">​</a></h3><h2 id="事务" tabindex="-1">事务 <a class="header-anchor" href="#事务" aria-label="Permalink to &quot;事务&quot;">​</a></h2><h3 id="事务隔离级别" tabindex="-1">事务隔离级别 <a class="header-anchor" href="#事务隔离级别" aria-label="Permalink to &quot;事务隔离级别&quot;">​</a></h3><p>默认隔离级别 read committed</p><p>show default_transaction_isolation;</p><h2 id="索引" tabindex="-1">索引 <a class="header-anchor" href="#索引" aria-label="Permalink to &quot;索引&quot;">​</a></h2><p>默认索引类型B-tree</p><h4 id="b-树索引" tabindex="-1">B-树索引 <a class="header-anchor" href="#b-树索引" aria-label="Permalink to &quot;B-树索引&quot;">​</a></h4><p>自平衡树</p><h4 id="哈希" tabindex="-1">哈希 <a class="header-anchor" href="#哈希" aria-label="Permalink to &quot;哈希&quot;">​</a></h4><p>用于等值查找</p><h4 id="gist" tabindex="-1">GiST <a class="header-anchor" href="#gist" aria-label="Permalink to &quot;GiST&quot;">​</a></h4><p>搜索树</p><h4 id="sp-gist" tabindex="-1">SP-GiST <a class="header-anchor" href="#sp-gist" aria-label="Permalink to &quot;SP-GiST&quot;">​</a></h4><p>空间区分GiST</p><h4 id="gin" tabindex="-1">GIN <a class="header-anchor" href="#gin" aria-label="Permalink to &quot;GIN&quot;">​</a></h4><p>广义倒排索引</p><h4 id="brin" tabindex="-1">BRIN <a class="header-anchor" href="#brin" aria-label="Permalink to &quot;BRIN&quot;">​</a></h4><p>区间索引</p><h2 id="底层原理" tabindex="-1">底层原理 <a class="header-anchor" href="#底层原理" aria-label="Permalink to &quot;底层原理&quot;">​</a></h2><p>PostgreSQL的存储引擎是数据库的心脏，负责数据的存储、检索和管理。它使用的核心技术是MVCC（多版本并发控制）模型。</p><p>参考文档<br><a href="https://mp.weixin.qq.com/s/k2nTYC_B-wnc3Np5HKA5JQ" target="_blank" rel="noreferrer">https://mp.weixin.qq.com/s/k2nTYC_B-wnc3Np5HKA5JQ</a></p><p><a href="https://zhuanlan.zhihu.com/p/457860359" target="_blank" rel="noreferrer">https://zhuanlan.zhihu.com/p/457860359</a></p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">查询数据蔟目录</span></span>
<span class="line"><span style="color:#A6ACCD;">SHOW DATA_DIRECTORY</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">查询表位置</span></span>
<span class="line"><span style="color:#F78C6C;">SELECT</span><span style="color:#A6ACCD;"> pg_relation_filepath(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">sys_dict</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">);</span></span>
<span class="line"><span style="color:#A6ACCD;">base</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">16388</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">16397</span></span>
<span class="line"><span style="color:#A6ACCD;">其中16388是数据库(tong)的Oid名；16397是sys_dict数据表名</span></span></code></pre></div><h2 id="性能优化" tabindex="-1">性能优化 <a class="header-anchor" href="#性能优化" aria-label="Permalink to &quot;性能优化&quot;">​</a></h2><h2 id="窗口函数" tabindex="-1">窗口函数 <a class="header-anchor" href="#窗口函数" aria-label="Permalink to &quot;窗口函数&quot;">​</a></h2><h2 id="继承" tabindex="-1">继承 <a class="header-anchor" href="#继承" aria-label="Permalink to &quot;继承&quot;">​</a></h2><h2 id="故障恢复" tabindex="-1">故障恢复 <a class="header-anchor" href="#故障恢复" aria-label="Permalink to &quot;故障恢复&quot;">​</a></h2><h2 id="日志" tabindex="-1">日志 <a class="header-anchor" href="#日志" aria-label="Permalink to &quot;日志&quot;">​</a></h2><h2 id="读写分离-分库分表" tabindex="-1">读写分离 分库分表 <a class="header-anchor" href="#读写分离-分库分表" aria-label="Permalink to &quot;读写分离 分库分表&quot;">​</a></h2><h2 id="多版本控制-mvcc" tabindex="-1">多版本控制 MVCC <a class="header-anchor" href="#多版本控制-mvcc" aria-label="Permalink to &quot;多版本控制 MVCC&quot;">​</a></h2><p><a href="https://cloud.tencent.com/developer/article/2406437" target="_blank" rel="noreferrer">https://cloud.tencent.com/developer/article/2406437</a></p>`,111),e=[p];function t(c,r,C,i,A,y){return a(),n("div",null,e)}const F=s(o,[["render",t]]);export{d as __pageData,F as default};
